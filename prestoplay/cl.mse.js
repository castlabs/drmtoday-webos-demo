(function(){var g={}; var _ = _ || {}
var f=function(window){var Jy,Ky,Ly,My,Ny,Oy,Py,Qy,Ry,Sy,Vy,Wy,Xy,Zy,$y,az,bz,cz,dz,fz,gz,hz,jz,kz,lz,mz,nz,pz,qz,rz,wz,xz,yz,zz,Az,Bz,Ez,Fz,Hz,Jz,Kz,Lz,Mz,Nz,Oz,Qz,Rz,Tz,Uz,Vz,Wz,Xz,Yz,Zz,aA,gA,lA,nA,pA,qA,rA,sA,tA,xA,zA,yA,AA,BA,EA,FA,GA,HA,JA,NA,LA,PA,QA,RA,SA,UA,TA,VA,XA,YA,ZA,aB,$A,cB,WA,dB,bB,eB,kB,hB,fB,iB,jB,lB,mB,pB,oB,qB,rB,sB,gB,tB,vB,nB,wB,xB,yB,zB,AB,BB,CB,DB,FB,GB,EB,OB,NB,PB,QB,SB,TB,VB,UB,WB,ZB,XB,YB,aC,$B,bC,cC,dC,gC,iC,hC,jC,kC,lC,mC,pC,oC,nC,rC,sC,tC,qC,vC,uC,zC,AC,CC,yC,xC,DC,wC,BC,HC,JC,GC,KC,FC,IC,
EC,MC,LC,OC,RC,TC,UC,ZC,bD,dD,fD,iD,kD,lD,nD,eD,qD,XC,rD,VC,pD,uD,sD,mD,oD,xD,wD,tD,DD,ED,yD,GD,zD,BD,JD,ID,CD,HD,KD,WC,AD,jD,YC,$C,QC,aD,FD,gD,hD,ND,OD,PD,VD,bE,TD,SD,RD,UD,XD,YD,ZD,$D,aE,fE,qE,rE,sE,mE,tE,kE,WD,KB,IB,LB,JB,MB,HB,CE,AE,oE,lE,vE,DE,BE,FE,uE,wE,cE,nE,GE,jE,HE,xE,KE,pE,iE,JE,IE,dE,EE,zE,ME,gE,yE,LE,NE,eE,OE,PE,QE,RE,SE,TE,UE,VE,WE;Jy=" buffer";Ky=" is being or has been set up";Ly="\x3c/DATA\x3e\x3c/WRMHEADER\x3e";My="\x3c/LA_URL\x3e";Ny="\x3cLA_URL\x3e";Oy='\x3cWRMHEADER xmlns\x3d"http://schemas.microsoft.com/DRM/2007/03/PlayReadyHeader" version\x3d"';
Py="Choosing new streams after key status change";Qy="IterateSegmentReference";Ry="Jumping forward";Sy="MediaSource threw QuotaExceededError:";_.Ty="No stream with id";_.Uy="Player is in ERROR state and can not switch to ";Vy="PrestoPlay TextTrack";Wy="Removing audio from variant - audio not compatible with platform";Xy="Setting playback rate to\x3d";_.Yy="Updating manifest...";Zy="bufferBehind\x3d";$y="bufferedBehind\x3d";az="calling onCanSwitch()...";bz="cannot find segment";cz="clpp.mse.Player";
dz="currentPeriod.startTime\x3d";_.ez="getSegmentNextReference";fz="key-restriction";gz="manifest.end";hz="manifest.start";_.iz="onChooseStreams_";jz="presentationTime:";kz="presentationTime\x3d";lz="reference.endTime\x3d";mz="reference.position\x3d";nz="reference.startTime\x3d";_.oz="subtitles";pz="switch: Stream ";qz=function(a,b){return _.Lg[a]=b};rz=function(a){for(var b=a.a+a.f.byteOffset,c=void 0;_.em(a);)if(0===_.gm(a)){c=a.a+a.f.byteOffset-1;break}a=a.f.buffer.slice(b,c);return _.R.Z(a)};
_.tz=function(a){var b=new Uint8Array(sz),c=4+b.byteLength+a.j.byteLength+4+a.f.byteLength,d=new _.am(c,!1);_.V(d,c);_.cm(d,b);_.cm(d,a.j);_.V(d,a.f.byteLength);_.cm(d,a.f);return _.Ui(d.buffer)};
_.uz=function(a,b,c,d){var e=_.gj(b);if(8!==e.byteLength)e="";else{var f=_.nn(e);e=_.dj(f);b:switch(f=f.byteLength,_.th("Trying to create PlayReady header in version",a),a){case "4.0.0.0":e=[Oy+a+'"\x3e',"\x3cDATA\x3e\x3cPROTECTINFO\x3e","\x3cKEYLEN\x3e"+f+"\x3c/KEYLEN\x3e","\x3cALGID\x3eAESCTR\x3c/ALGID\x3e\x3c/PROTECTINFO\x3e","\x3cKID\x3e"+e+"\x3c/KID\x3e",c?"\x3cCHECKSUM\x3e"+c+"\x3c/CHECKSUM\x3e":"",d?Ny+d+My:"",Ly].join("");break b;case "4.1.0.0":e=[Oy+a+'"\x3e','\x3cDATA\x3e\x3cPROTECTINFO\x3e\x3cKID ALGID\x3d"AESCTR" ',
c?'CHECKSUM\x3d"'+c+'" ':"",'VALUE\x3d"'+e+'"',"\x3e\x3c/KID\x3e\x3c/PROTECTINFO\x3e",d?Ny+d+My:"",Ly].join("");break b;case "4.2.0.0":case "4.3.0.0":e=[Oy+a+'"\x3e','\x3cDATA\x3e\x3cPROTECTINFO\x3e\x3cKIDS\x3e\x3cKID ALGID\x3d"AESCTR" ',c?'CHECKSUM\x3d"'+c+'" ':"",'VALUE\x3d"'+e+'"',"\x3e\x3c/KID\x3e\x3c/KIDS\x3e\x3c/PROTECTINFO\x3e",d?Ny+d+My:"",Ly].join("");break b;default:_.J("Cannot create PlayReady header in version",a),e=""}}if(!e)return null;_.th("New payload",e);e=_.Ui(_.R.Ce(e,!0));return new _.kn(_.on,
b,d||null,e,a,c)};_.vz=function(a,b){return b===a.version?a:_.uz(b,a.a,a.l||void 0,a.h||void 0)};wz=function(a,b){a:{if(b){var c=_.u(a.f.keys());for(var d=c.next();!d.done;d=c.next()){d=a.f.get(d.value);for(var e=0;e<d.$a.length;e++)if(d.$a[e]===b){c=d;break a}}}c=null}return c?c.Ja:null};xz=function(a,b){return _.xk("Edge/")?!0:a.M.has(b)};yz=function(a,b){var c=a.l.get(b);return!(!c||c!==_.bf&&c!==_.ve)};
zz=function(a,b){var c=b.audio,d=b.video;if(c&&c.encrypted&&!xz(a,_.rk(c.mimeType,c.codecs))||d&&d.encrypted&&!xz(a,_.rk(d.mimeType,d.codecs)))return!1;var e=a.keySystem();return 0==b.drmInfos.length||b.drmInfos.some(function(f){return f.keySystem==e})};Az=function(a,b){a.a=b.enabled};Bz=function(){};
_.Cz=function(a,b,c){return{keySystem:a,licenseServerUri:"",distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:"",videoRobustness:"",serverCertificate:null,initData:b||[],keyIds:[],periodId:c?c:null}};_.Dz=function(a,b,c,d,e){this.Sa=a;this.wa=b;this.ia=c;this.keyInfo=d||null;this.Oc=_.N.R(e)?!1:!!e};Ez=function(a,b){a=_.Ni(a);b=_.Ni(b);var c=a.split("-"),d=b.split("-");return c[0]==d[0]&&1==c.length&&2==d.length};
Fz=function(a){return a.language?_.Ni(a.language):a.audio&&a.audio.language?_.Ni(a.audio.language):a.video&&a.video.language?_.Ni(a.video.language):_.hg};
_.Gz=function(a,b){for(var c=_.Ni(a),d=new Set,e=_.u(b),f=e.next();!f.done;f=e.next())d.add(_.Ni(f.value));e=_.u(d);for(f=e.next();!f.done;f=e.next())if(f=f.value,f==c)return f;e=_.u(d);for(f=e.next();!f.done;f=e.next())if(f=f.value,Ez(f,c))return f;e=_.u(d);for(f=e.next();!f.done;f=e.next()){var g=f=f.value,h=c;g=_.Ni(g);h=_.Ni(h);g=g.split("-");h=h.split("-");if(2==g.length&&2==h.length&&g[0]==h[0])return f}d=_.u(d);for(f=d.next();!f.done;f=d.next())if(e=f.value,Ez(c,e))return e;return null};
Hz=function(a,b){for(var c=0,d=_.u(a),e=d.next();!e.done;e=d.next())c+=b(e.value)?1:0;return c};_.Iz=function(a){if(_.au.has(a))return _.au.get(a);if(window.ManagedMediaSource){var b=ManagedMediaSource.isTypeSupported(a);_.au.set(a,b);return b}return window.MediaSource?(b=MediaSource.isTypeSupported(a),_.au.set(a,b),b):!1};
Jz=function(){this.a=new muxjs.mp4.Transmuxer({keepOriginalTimestamps:!0,remux:!1});this.f=null;this.o=[];this.l=[];this.h=[];this.j=!1;this.a.on("data",this.A.bind(this));this.a.on("done",this.w.bind(this))};Kz=function(a,b){a.j=!0;a.f=new _.wj;a.o=[];a.l=[];a.h=[];var c=_.Ui(b);a.a.push(c);a.a.flush();a.j&&a.f.reject(new _.P(_.Q,3,3018));return a.f};
Lz=function(a,b){var c=b.replace(/mp2t/i,_.Pe);a==_.$c&&(c=c.replace(_.sg,_.$c));var d=/avc1\.(66|77|100)\.(\d+)/.exec(c);if(d){var e="avc1.",f=d[1],g=Number(d[2]);e=("66"==f?e+"4200":"77"==f?e+"4d00":e+"6400")+(g>>4).toString(16);e+=(g&15).toString(16);c=c.replace(d[0],e)}return c};
Mz=function(a,b){return!window.muxjs||"mp2t"!=a.toLowerCase().split(";")[0].split("/")[1]&&"aac"!=a.toLowerCase().split(";")[0].split("/")[1]?!1:b?_.Iz(Lz(b,a))||_.Iz(a.replace(/aac/i,_.Pe)):_.Iz(Lz(_.$c,a))||_.Iz(a.replace(/aac/i,_.Pe))||_.Iz(Lz(_.sg,a))};
Nz=function(a,b){var c=new Map;c.set(a,b);try{var d=b.match(/"(.*?)"/)[0].replace(/"/g,"").split(","),e=new Map;if(1<d.length)for(var f=_.u(d),g=f.next();!g.done;g=f.next()){var h=g.value;h.startsWith("avc")?e.set(_.sg,'video/mp4;codecs\x3d"'+h+'"'):h.startsWith("mp4a")&&e.set(_.$c,'audio/mp4;codecs\x3d"'+h+'"')}return 0<e.size?e:c}catch(l){return c}};Oz=function(a){var b=[a.mimeType];_.bu.forEach(function(c,d){var e=a[d];e&&b.push(c+'\x3d"'+e+'"')});return b.join(";")};
_.Pz=function(a){a=a.split(".");var b=a[0];a.pop();return[b,a.join(".")]};Qz=function(a,b){for(var c=new _.sl(void 0,void 0===b?"total":b),d=_.u(a),e=d.next();!e.done;e=d.next())c.a.push(e.value);c.length=a.length;return c};Rz=function(a,b){return a.start-b.start};_.Sz=function(a){this.j=a;this.log=new _.K("clpp.renditions");this.S=[];this.h=this.player=null;this.f=!1};Tz=function(a){return a.S.map(function(b){return{start:b.start,end:b.end,width:b.width,height:b.height,bandwidth:b.bandwidth,rendition:b.rendition}})};
Uz=function(a){a.player&&a.player.trigger(new _.L(_.ed))};Vz=function(a){if(a.player){for(var b=!1,c={},d=0;d<a.S.length;d++){var e=a.S[d],f=e.width+"x"+e.height,g=c[f];if(g&&g!==e.bandwidth){b=!0;break}c[f]=e.bandwidth}b&&!a.f?(a.log.debug("Tracking timeupdates"),a.player.on(_.eg,a.a,a),a.f=!0):!b&&a.f&&(a.log.debug("Stop tracking timeupdates"),a.player.off(_.eg,a.a),a.f=!1)}};
Wz=function(a,b,c){a.S=a.S.filter(function(d){if(d.end<=b||d.start>=c)return!1;d.start=Math.max(d.start,b);d.end=Math.min(d.end,c);return!0});a.player&&a.player.trigger(new _.L(_.vg))};Xz=function(a,b){for(var c=null,d=_.u(a),e=d.next();!e.done;e=d.next())e=e.value,b>=e.startTime&&(c=e);return c};
Yz=function(a){var b=new Set;a.variants.forEach(function(c){c.audio&&b.add(c.audio);c.video&&(b.add(c.video),c.video.trickModeVideo&&b.add(c.video.trickModeVideo))});a.textStreams.forEach(function(c){return b.add(c)});a.thumbStreams.forEach(function(c){return b.add(c)});return b};Zz=function(a,b){for(var c=0;c<a.length;c++)if(Yz(a[c]).has(b))return c;return-1};aA=function(a,b){Array.from(Yz(a)).forEach(function(c){c.segmentIndex&&_.$z(c.segmentIndex,b)})};
_.bA=function(a){this.h=Math.exp(Math.log(.5)/a);this.f=this.a=0};_.cA=function(a,b,c){var d=Math.pow(a.h,b);c=c*(1-d)+d*a.a;isNaN(c)||(a.a=c,a.f+=b)};_.dA=function(a){return a.a/(1-Math.pow(a.h,a.f))};
_.eA=function(a,b,c,d,e,f,g,h){a=_.rj(a);a.timeout=d.timeout;a.maxAttempts=d.maxAttempts;a.baseDelay=d.baseDelay;a.fuzzFactor=d.fuzzFactor;a.backoffFactor=d.backoffFactor;if(0!==b||null!=c)a.headers.Range=c?"bytes\x3d"+b+"-"+c:"bytes\x3d"+b+"-";e&&(a.startTime=e);f&&(a.endTime=f);g&&(a.contentType=g);h&&(a.timescale=h);return a};
_.fA=function(a,b,c,d,e){e=void 0===e?!1:e;this.A=a;this.G=b;this.w=this.f=Infinity;this.a=1;this.B=0;this.h=this.o=null;this.C=0;this.l=this.j=c;this.I=void 0===d?!0:d;this.g=new _.K("clpp.media.PresentationTimeline");this.J=e;this.H=null};gA=function(a){return a.j?a.f:a.l?a.h:null};
_.jA=function(a,b,c){if(0!=b.length){var d=b[b.length-1].endTime+c;_.hA(a,b[0].startTime+c);a.a=b.reduce(function(e,f){return Math.max(e,f.endTime-f.startTime)},a.a);_.iA(a,d);null!=a.A&&a.I&&(a.A=(Date.now()+a.C)/1E3-(a.h||0)-a.a);a.g.debug("notifySegments: maxSegmentDuration\x3d"+a.a)}};_.hA=function(a,b){a.o=null==a.o?b:Math.min(a.o,b)};_.iA=function(a,b){a.h=Math.max(a.h||0,b)};_.kA=function(a,b){a.a=Math.max(a.a,b);a.g.debug("notifyNewSegmentDuration: maxSegmentDuration\x3d"+a.a)};
_.mA=function(a){return Infinity==a.w?0:Math.max(0,lA(a)-a.w)};lA=function(a){if(a.j)a=a.f;else if(a.l)a=a.h||0;else{var b=(Date.now()+a.C)/1E3;a=Math.min(a.J?Math.max(0,b-(a.a-a.B)-a.A):Math.max(0,b-a.a-a.A),a.f)}return a};_.oA=function(a,b){var c=Math.max(a.o,0);return Infinity==a.w?Math.ceil(1E3*c)/1E3:Math.max(c,Math.min(lA(a)-a.w+b,nA(a)))};nA=function(a){return Math.max(0,lA(a)-(a.j||a.l?0:a.G))};
pA=function(a){return{schemeIdUri:a.schemeIdUri,value:a.value,startTime:a.startTime,endTime:a.endTime,id:a.id,eventElement:a.eventElement,type:a.type,Wa:a.Wa}};qA=function(){this.f=function(){};this.a=new Set};rA=function(a,b){a.f=b};sA=function(a,b,c){this.h=a;this.a=b;this.f=c;this.g=new _.K("clpp.media.SegmentIterator")};tA=function(a){var b=a.h.get(a.a);if(!b)return null;0<b.a.length&&b.Sa().length&&a.f>=b.a.length&&(a.a+=1,a.f=0,b=a.h.get(a.a));return b&&0<b.a.length?b.a[a.f]||null:b};
_.uA=function(a){this.a=a;this.g=new _.K("clpp.media.SegmentIndex")};_.vA=function(a){return a.a.length?a.a[a.a.length-1].endTime:0};_.wA=function(a,b){for(var c=0;c<a.a.length;++c)if(a.a[c].endTime>b)return a.a.splice(0,c);c=a.a;a.a=[];return c};xA=function(a,b){var c=a.Mc(b);c=null===c?-1:c-1;var d=a.get(c+1),e=-1;if(d&&0<d.a.length)for(var f=d.a.length-1;0<=f;--f){var g=d.a[f];if(b>=g.startTime&&b<g.endTime){for(;f&&!g.h;)--f,g=d.a[f];if(!g.h)break;c+=1;e=f-1;break}}return new sA(a,c,e)};
_.$z=function(a,b){for(;a.a.length;)if(0>=a.a[0].endTime)a.a.shift();else break;0==a.a.length||a.a[a.a.length-1].startTime>=b||(a.a[a.a.length-1].endTime=b)};zA=function(a){var b=this;this.f=a;this.a=new Set;this.h=(new _.uk(function(){yA(b,!1)})).jb(.25)};yA=function(a,b){for(var c=_.u(a.a),d=c.next();!d.done;d=c.next())d.value.o(a.f.currentTime,b)};
AA=function(a){var b=this;this.l=a;this.j=new Map;this.a=function(){};this.f=function(){};this.h=function(){};this.w=[{Bc:null,Ac:2,oc:function(c,d){return b.a(c,d)}},{Bc:1,Ac:2,oc:function(c,d){return b.a(c,d)}},{Bc:3,Ac:2,oc:function(c,d){return b.a(c,d)}},{Bc:2,Ac:1,oc:function(c,d){return b.f(c,d)}},{Bc:2,Ac:3,oc:function(c,d){return b.f(c,d)}},{Bc:1,Ac:3,oc:function(c,d){return b.h(c,d)}},{Bc:3,Ac:1,oc:function(c,d){return b.h(c,d)}}]};BA=function(a,b,c,d){a.a=b;a.f=c;a.h=d};
_.CA=function(a){_.Fs[a]&&delete _.Fs[a]};_.DA=function(a){_.Ds[a]&&delete _.Ds[a]};EA=function(a,b){this.w=null;this.C=a;this.h=b;this.j=this.A=0;this.l=Infinity;this.f=this.a=null;this.B="";this.o=new Map};
FA=function(a,b,c,d){return Promise.resolve().then(function(){if(a.w&&a.h)if(null==c||null==d)a.w.parseInit(_.Ui(b));else{var e={periodStart:a.A,segmentStart:c,segmentEnd:d};e=a.w.parseMedia(_.Ui(b),e);var f=e.cues.filter(function(g){return g.startTime>=a.j&&g.startTime<a.l});a.h.append(f,e.styles);null==a.a&&(a.a=Math.max(c,a.j));a.f=Math.min(d,a.l)}})};
GA=function(a,b,c){a.B=b;if(b=a.o.get(b))for(var d=_.u(b.keys()),e=d.next();!e.done;e=d.next())if(e=b.get(e.value))e=e.filter(function(f){return f.endTime<=c}),a.h.append(e,[])};
HA=function(a,b,c,d,e){var f=c+" "+d,g=new Map;b=_.u(b);for(var h=b.next();!h.done;h=b.next()){var l=h.value;h=l.stream;g.has(h)||g.set(h,new Map);g.get(h).has(f)||g.get(h).set(f,[]);l.startTime+=e;l.endTime+=e;l.startTime>=a.j&&l.startTime<a.l&&(l=new _.di(l.startTime,l.endTime,l.text),g.get(h).get(f).push(l),h==a.B&&a.h.append([l],[]))}e=_.u(g.keys());for(f=e.next();!f.done;f=e.next())for(f=f.value,a.o.has(f)||a.o.set(f,new Map),b=_.u(g.get(f).keys()),h=b.next();!h.done;h=b.next())h=h.value,l=g.get(f).get(h),
a.o.get(f).set(h,l);a.a=null==a.a?Math.max(c,a.j):Math.min(a.a,Math.max(c,a.j));a.f=Math.max(a.f,Math.min(d,a.l))};_.IA=function(a){a=a.toLowerCase();return _.ft[a]||window.muxjs&&a==_.Sc?!0:!1};JA=function(){this.a=new muxjs.mp4.CaptionParser;this.l=[];this.j={}};_.KA=function(){};
_.MA=function(a,b,c,d,e){this.j=a;this.B=c;this.f={};this.M=!1;this.a=null;this.h={};this.l=new _.Eh;this.J=!1;this.A={};this.H=b;this.C=d;this.K=e;this.T=this.K.streaming.maxSegmentToMediaOffset||1;this.I=new _.wj;this.w="";this.G={};this.o=LA(this,this.I);this.P=!0;this.g=new _.K("clpp.mse.MediaSourceEngine")};NA=function(a){var b=_.rk(a.mimeType,a.codecs),c=Oz(a);return _.IA(b)||_.Iz(c)||Mz(b,a.type)};
LA=function(a,b){if(window.ManagedMediaSource){a.j.disableRemotePlayback=!0;var c=new ManagedMediaSource;a.l.one(c,"sourceopen",function(){URL.revokeObjectURL(a.w);b.resolve()});a.l.on(c,"startstreaming",function(){a.P=!0});a.l.on(c,"endstreaming",function(){a.P=!1});a.w=OA(c);a.j.src=a.w;return c}c=new MediaSource;a.w=OA(c);a.l.one(c,"sourceopen",function(){URL.revokeObjectURL(a.w);b.resolve()});a.j.src=a.w;return c};
PA=function(a,b){b.forEach(function(c,d){var e=a.o.addSourceBuffer(c);a.l.on(e,_.ne,a.U.bind(a,d));a.l.on(e,"updateend",a.$c.bind(a,d));a.f[d]=e;a.h[d]=[];a.G[d]=!1});a.M=b.has(_.$c)&&b.has(_.sg)};QA=function(a){return a.K.streaming.ignoreManagedMediaSourceStreamingHints?!0:a.P};RA=function(a,b){a.a||(a.a=new EA(a.K,a.B));var c=a.a;if(b!=_.Sc){var d=_.ft[b];if(!d)throw new _.P(_.Q,2,2012,"Text parser is unavailable for "+b);c.w=new d(c.C)}};SA=function(a){return a.o?a.o.readyState==_.me:!0};
UA=function(a){var b={};b.total=new _.sl(a.j.buffered,"total");b.audio=TA(a,_.$c);b.video=TA(a,_.sg);var c=[];a.a&&(c=[{start:a.a.wb(),end:a.a.Fa()}]);b.text=Qz(c,_.bg);return b};TA=function(a,b){try{return new _.sl(a.f[b].buffered,b)}catch(c){return b in a.f&&a.g.error("failed to get buffered range for "+b,c),null}};VA=function(a,b){if(!a.f[b])return"";var c=TA(a,b);return c?c.toString():""};
XA=function(a,b,c,d,e,f,g,h){h=void 0===h?!1:h;var l=a.f[b],m=-1,n=0;l&&l.buffered&&(n=l.buffered.length);b===_.sg&&null!==d&&null!==e&&h&&(m=0<n?l.buffered.end(n-1):-1);b==_.bg?c=FA(a.a,c,d,e):a.A[b]?c=Kz(a.A[b],c).then(function(p){p.captions&&0<p.captions.length&&(a.a||RA(a,_.cg),HA(a.a,p.captions,d,e,a.f.video.timestampOffset));var q=[];0<p.audio.byteLength&&a.f.audio&&q.push(WA(a,_.$c,a.Ze.bind(a,_.$c,p.audio.buffer)));0<p.video.byteLength&&a.f.video&&q.push(WA(a,_.sg,a.Ze.bind(a,_.sg,p.video.buffer)));
return Promise.all(q)}):(f&&window.muxjs&&(a.a||RA(a,_.cg),null==d&&null==e?a.H.init(c):a.H.h(c,function(p){p.length&&HA(a.a,p,d,e,a.f.video.timestampOffset)})),c=WA(a,b,a.Ze.bind(a,b,c)));return c.then(function(){if(b===_.sg&&null!==d&&null!==e&&!h)a.C.append(d,e,g),null!==d&&null!==e&&a.g.debug("Appended video segment ",d,e,"Buffer:",VA(a,b));else if(b===_.$c&&null!==d&&null!==e)Uz(a.C),null!==d&&null!==e&&a.g.debug("Appended audio segment ",d,e,"Buffer:",VA(a,b));else if(b===_.sg&&null!==d&&null!==
e&&h){var p=l.buffered.length,q=0<p?l.buffered.end(p-1):-1;0>m&&0<p&&(m=l.buffered.start(0));0<=m&&0<q&&a.C.append(m,q,g)}if(!a.G[b]&&l&&1===l.buffered.length){p=l.buffered.start(0);var t=d-p;if(Math.abs(t)>a.T&&0===l.timestampOffset)return a.g.warn("Detected a delta of "+t+" between media times and segment times for "+(b+". The segment start time is ")+(d+" and the media start time is ")+(p+". Adjusting timestampOffset.")),p=WA(a,b,function(){a.Lh(b,t)}),q=WA(a,b,a.Ig.bind(a,b,!1)),Promise.all([p,
q])}null!==d&&null!==e&&(a.G[b]=!0)})["catch"](function(p){throw p;})};YA=function(a,b){var c=a.Fa(_.sg)||0;GA(a.a,b,c)};ZA=function(a){a.a&&GA(a.a,"",0)};aB=function(a,b,c,d,e){if(b==_.bg)return a.a.A=c,a=a.a,a.j=d,a.l=e,Promise.resolve();b=$A(a,b,c,d,e);a.M&&(b=b.concat($A(a,_.$c,c,d,e)));return Promise.all(b)};$A=function(a,b,c,d,e){return[WA(a,b,a.di.bind(a,b)),WA(a,b,a.Lh.bind(a,b,c)),WA(a,b,a.gm.bind(a,b,d,e))]};cB=function(a,b){bB(a,function(){a.o.duration=b})};
WA=function(a,b,c){if(a.J)return Promise.reject();c={start:c,p:new _.wj};a.h[b].push(c);1===a.h[b].length&&dB(a,b);return c.p};dB=function(a,b){var c=a.h[b][0];if(c)try{a.g.debug("Starting next operation for "+b),c.start()}catch(d){"QuotaExceededError"==d.name?c.p.reject(new _.P(_.Q,3,3017,{type:b})):c.p.reject(new _.P(_.Q,3,3015,{mediaError:d})),eB(a,b)}else a.g.debug("No more scheduled operations for "+b)};
bB=function(a,b){if(a.J)return Promise.reject();var c=[],d;for(d in a.f){var e=new _.wj,f={start:function(g){g.resolve()}.bind(null,e),p:e};a.h[d].push(f);c.push(e);1==a.h[d].length&&f.start()}return Promise.all(c).then(function(){for(var g in a.f);try{b()}catch(m){var h=Promise.reject(new _.P(_.Q,3,3015,{mediaError:m}))}for(var l in a.f)eB(a,l);return h},function(){for(var g in a.f)a.h[g].length&&a.h[g].shift();return Promise.reject()})};eB=function(a,b){a.h[b].shift();dB(a,b)};
kB=function(a,b,c,d){var e=a.periods.flatMap(function(n){return n.variants});if(b.length||c.length)e=fB(e,b,c);e=gB(e,d);if(1<a.periods.length){var f=function(n){n=n.split(".");var p=n[0];1<n.length&&(p+="."+n[1]);return p.toLowerCase()};b=[];c=_.u(a.periods);for(var g=c.next();!g.done;g=c.next()){d=new Set;g=_.u(g.value.variants);for(var h=g.next();!h.done;h=g.next())h=h.value,null!==h.audio&&d.add(f(h.audio.codecs));b.push(d)}var l=b[0];c={};for(d=1;d<b.length;c={Ie:c.Ie},d++)c.Ie=b[d],l=new Set(_.Og(l).concat().filter(function(n){return function(p){return n.Ie.has(p)}}(c)));
e=e.filter(function(n){return 0===l.size&&null===n.audio?!0:0<l.size&&null===n.audio?!1:l.has(f(n.audio.codecs))})}e=hB(e);var m=iB(e);a=_.u(a.periods);for(e=a.next();!e.done;e=a.next())e=e.value,e.variants=e.variants.filter(function(n){if(jB(n)===m)return!0;_.th("Dropping Variant (better codec available)",n);return!1})};hB=function(a){var b=new _.Bh;a=_.u(a);for(var c=a.next();!c.done;c=a.next()){c=c.value;var d=jB(c);b.push(d,c)}return b};
fB=function(a,b,c){var d={};b=_.u(b);for(var e=b.next();!e.done;d={Ne:d.Ne},e=b.next())if(d.Ne=e.value,e=a.filter(function(f){return function(g){return g.video&&g.video.codecs.startsWith(f.Ne)}}(d)),e.length){a=e;break}d={};c=_.u(c);for(b=c.next();!b.done;d={Ge:d.Ge},b=c.next())if(d.Ge=b.value,b=a.filter(function(f){return function(g){return g.audio&&g.audio.codecs.startsWith(f.Ge)}}(d)),b.length){a=b;break}return a};
iB=function(a){var b="",c=Infinity;a.forEach(function(d,e){var f=e.reduce(function(g,h){return g+h.bandwidth||0},0)/e.length;_.th(_.Jd,d,"avg bandwidth",f);f<c&&(b=d,c=f)});return b};jB=function(a){var b="";a.video&&(b=_.Pz(a.video.codecs)[0]);var c="";a.audio&&(c=_.Pz(a.audio.codecs)[0]);return b+"-"+c};
lB=function(a,b,c){function d(f,g,h){return f>=g&&f<=h}var e=a.video;return e&&e.width&&e.height&&!(d(e.width,b.minWidth,Math.min(b.maxWidth,c.width))&&d(e.height,b.minHeight,Math.min(b.maxHeight,c.height))&&d(e.width*e.height,b.minPixels,b.maxPixels))||!d(a.bandwidth,b.minBandwidth,b.maxBandwidth)?!1:!0};mB=function(a,b,c){var d=!1;a=_.u(a);for(var e=a.next();!e.done;e=a.next()){e=e.value;var f=e.allowedByApplication;e.allowedByApplication=lB(e,b,c);f!=e.allowedByApplication&&(d=!0)}return d};
pB=function(a,b,c,d){var e=!1;d.variants=d.variants.filter(function(m){if(a&&a.da&&!zz(a,m))return _.th("Dropping variant - not compatible with key system",m),!1;var n=m.audio,p=m.video;if(n&&!NA(n)){var q=n.codecs;0<=n.codecs.indexOf("ec-3")?(_.th("Trying to use AC-3 for EC-3"),n.codecs=n.codecs.replace("ec-3","ac-3"),NA(n)?_.sh("Using AC-3 instead of EC-3 for",nB(n)):(n.codecs=q,_.sh(Wy,nB(n)),m.audio=null,e=!0,n=null)):(_.sh(Wy,nB(n)),m.audio=null,e=!0,n=null)}return p&&!NA(p)?(_.sh("Dropping variant - video not compatible with platform",
nB(p)),!1):n&&b&&!oB(n,b)?(_.sh("Dropping variant - not compatible with active audio","active audio",nB(b),"variant.audio",nB(n)),!1):p&&c&&!oB(p,c)?(_.sh("Dropping variant - not compatible with active video","active video",nB(c),"variant.video",nB(p)),!1):!0});if(e){for(var f=!1,g=!1,h=_.u(d.variants),l=h.next();!l.done;l=h.next())l=l.value,!f&&l.video&&l.audio&&(f=!0),g||l.audio||!l.video||(g=!0);f&&g&&(d.variants=d.variants.filter(function(m){return m.video&&!m.audio?(_.sh("Dropping variant - not compatible with video + audio",
"variant.video",nB(m.video)),!1):!0}))}d.textStreams=d.textStreams.filter(function(m){var n=_.IA(_.rk(m.mimeType,m.codecs));n||_.th("Dropping text stream. Is not supported by the platform.",m);return n})};oB=function(a,b){return a.mimeType!=b.mimeType||a.codecs.split(".")[0]!=b.codecs.split(".")[0]?!1:!0};
qB=function(a){var b=a.audio,c=a.video,d=b?b.codecs:null,e=c?c.codecs:null,f=[];e&&f.push(e);d&&f.push(d);var g=c&&c.mimeType||null,h=b&&b.mimeType||null,l=[];b&&l.push(b.kind);c&&l.push(c.kind);l=l[0]||null;var m=new Set,n=new Set;if(b)for(var p=_.u(b.roles),q=p.next();!q.done;q=p.next())n.add(q.value);if(c)for(p=_.u(c.roles),q=p.next();!q.done;q=p.next())m.add(q.value);q=[c,b].map(function(t){return t?t.accessibility||[]:[]}).reduce(function(t,v){return t.concat(v)},[]);a={id:a.id,active:!1,type:"variant",
bandwidth:a.bandwidth,language:a.language,originalLanguage:a.language,label:null,kind:l,width:null,height:null,frameRate:null,trickPlay:!1,mimeType:g,audioMimeType:h,codecs:f.join(", "),audioCodec:d,videoCodec:e,primary:a.primary,roles:Array.from(m),audioRoles:Array.from(n),videoId:null,audioId:null,channelsCount:null,spatialAudio:!1,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null,accessibility:q,keyId:c?c.keyId:b?b.keyId:null};c&&(a.videoId=c.id,
a.originalVideoId=c.originalId,a.width=c.width||null,a.height=c.height||null,a.frameRate=c.frameRate||null,a.trickPlay=!!c.trickPlay,a.videoBandwidth=c.bandwidth||null);b&&(a.audioId=b.id,a.originalAudioId=b.originalId,a.originalLanguage=b.originalLanguage,a.channelsCount=b.channelsCount,a.audioBandwidth=b.bandwidth||null,a.label=b.label,a.audioRoles=b.roles);return a};
rB=function(a){return{id:a.id,active:!1,type:_.bg,bandwidth:0,language:a.language,originalLanguage:a.originalLanguage,label:a.label,kind:a.kind||null,width:null,height:null,frameRate:null,trickPlay:!1,mimeType:a.mimeType,audioMimeType:null,codecs:a.codecs||null,audioCodec:null,videoCodec:null,primary:a.primary,roles:a.roles,audioRoles:null,videoId:null,audioId:null,channelsCount:null,spatialAudio:!1,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:a.originalId,
accessibility:a.accessibility,keyId:null}};sB=function(a){return a.allowedByApplication&&a.allowedByKeySystem};gB=function(a,b){var c=a.filter(function(g){return g.audio&&g.audio.channelsCount}),d=new Map;c=_.u(c);for(var e=c.next();!e.done;e=c.next()){e=e.value;var f=e.audio.channelsCount;d.has(f)||d.set(f,[]);d.get(f).push(e)}c=Array.from(d.keys());if(0===c.length)return a;e=c.filter(function(g){return g<=b});return e.length?d.get(Math.max.apply(null,e)):d.get(Math.min.apply(null,c))};
_.uB=function(a,b,c,d){b=_.Th(b);var e=a,f=a.filter(function(h){return h.primary});f.length&&(e=f);var g=e.length?e[0].language:"";e=e.filter(function(h){return h.language===g});b.some(function(h){var l=_.Gz(_.Ni(h),a.map(function(m){return m.language}));return l?(e=a.filter(function(m){return _.Ni(m.language)===l}),!0):!1});e=e.filter(function(h){return d?h.kind===_.oe:h.kind!==_.oe});if(c){b=tB(e,c);if(b.length)return b;_.J("No exact match for the text role could be found.")}else if(b=e.filter(function(h){return 0===
h.roles.length}),b.length)return b;b=e.map(function(h){return h.roles}).reduce(_.mi,[]);return b.length?tB(e,b[0]):e};tB=function(a,b){return a.filter(function(c){return c.roles.includes(b)})};vB=function(a,b,c){for(var d=0;d<c.length;d++)if(c[d].audio===a&&c[d].video===b)return c[d];return null};
nB=function(a){var b=Oz(a);return a.type===_.$c?"type\x3daudio mimeType\x3d"+a.mimeType+" codecs\x3d"+a.codecs+" codecInfo\x3d"+b+" bandwidth\x3d"+a.bandwidth+" channelsCount\x3d"+a.channelsCount:a.type===_.sg?"type\x3dvideo mimeType\x3d"+a.mimeType+" codecs\x3d"+a.codecs+" codecInfo\x3d"+b+" bandwidth\x3d"+a.bandwidth+" frameRate\x3d"+a.frameRate+" width\x3d"+a.width+" height\x3d"+a.height:"unexpected stream type"};
wB=function(a,b){var c=String(_.Tj++);c=new _.Oj(c,a);c.mimeType=_.Pj(b.mimeType);if(a===_.S||a===_.T)c.label=_.Pj(b.label),c.language=_.Pj(b.language),c.originalLanguage=_.Pj(b.originalLanguage);a===_.Qj?(c.frameRate=b.frameRate,c.roles=b.roles,c.trickPlay=b.trickPlay):a===_.T?(c.channelsCount=b.channelsCount,c.roles=b.audioRoles||[],c.mimeType=_.Pj(b.audioMimeType)):(c.kind=_.Pj(b.kind),c.roles=b.roles);c.accessibility=a===_.Qj||a===_.T?(b.accessibility||[]).filter(function(d){return d.type===a}):
b.accessibility||[];return c};
xB=function(a,b,c){var d=new _.Wj(a===_.Qj?""+b.videoId:a===_.T?""+b.audioId:""+b.id,c);switch(a){case _.Qj:d.codec=_.Pj(b.videoCodec);d.bandwidth=b.videoBandwidth||b.bandwidth;d.width=b.width;d.height=b.height;d.originalId=b.originalVideoId;d.drm={keyId:b.keyId||void 0};break;case _.T:d.codec=_.Pj(b.audioCodec);d.bandwidth=b.audioBandwidth||b.bandwidth;d.originalId=b.originalAudioId;d.drm={keyId:b.keyId||void 0};break;default:d.codec=_.Pj(b.codecs),d.originalId=b.originalTextId}(a=c.renditions.find(function(e){return _.N.ta(e,
d,null,["id","track"])}))||c.renditions.push(d);return a||d};yB=function(a,b){var c=a.reduce(function(d,e){b===_.Qj?null===e.videoId||d[e.videoId]&&!e.active||(d[e.videoId]=e):b===_.T&&(null===e.audioId||d[e.audioId]&&!e.active||(d[e.audioId]=e));return d},{});return Object.values(c)};zB=function(a,b){if(void 0!==b&&null!==b){var c=a.filter(function(d){return d.audio&&d.audio.id===b});if(0<c.length)return c}return a};
AB=function(a,b,c){function d(f,g){return null==f?null==g:g.id==f}for(var e=0;e<c.length;e++)if(d(a,c[e].audio)&&d(b,c[e].video))return c[e];return null};BB=function(){this.g=new _.K("cl.api.mse.TrackManager");this.m=null;this.h=[];this.a=new Map;this.f=new Map};CB=function(a,b){return a.h.filter(function(c){return c.type===b})};DB=function(a,b){var c=a.a.get(b)||null;return c&&c.track};
FB=function(a,b,c){if(!c||DB(a,c.type)!==c||a.m.ma())switch(b){case _.Qj:a.Ya(c&&c.renditions[0]);break;case _.T:a.gb(c&&c.renditions[0]);break;case _.S:a.hb(c&&c.renditions[0]);break;default:EB(a,b,c&&c.renditions[0])}};GB=function(a,b){a.a.set(b.track.type,b);b===(a.f.get(b.track.type)||null)&&a.f.set(b.track.type,null)};
EB=function(a,b,c,d){d=void 0===d?!1:d;if(a.m&&((a.a.get(b)||null)!==c||a.m.ma())){var e=a.m;if(c){if(0>a.h.indexOf(c.track))throw Error("Unknown rendition with ID "+c.id);if(b!==c.track.type)throw Error("Types mismatch");a.g.debug("Activate rendition type\n          "+b+" with ID: "+c.id);if(b===_.S){var f=e.fa().find(function(n){return n.id==c.id});f&&(a.f.set(b,c),GB(a,c),e.trigger(new _.L(_.nl)),HB(e,!0).then(function(){IB(e,f)})["catch"](function(n){a.g.warn("Error while activating track",n)}))}else if(b===
_.T)a.f.set(b,c),JB(e,parseInt(c.id,10));else if(b===_.Qj){var g=a.a.get(_.T)||null,h=null;if(g){var l=KB(e).filter(function(n){return n.videoId==c.id});h=l.find(function(n){return n.audioId==g.id})||null;if(!h){a.g.debug("Unable to find exact variant. Searching for equivalent");var m=g.track.renditions.map(function(n){return n.id}).filter(function(n){return n!==g.id});h=l.find(function(n){return m.find(function(p){return p==n.audioId})})||null}}else h=KB(e).find(function(n){return n.videoId==c.id})||
null;h?(a.f.set(b,c),LB(e,h,d)):a.g.warn("Cannot find matching variant")}}else a.g.debug(_.Ja+b),(h=DB(a,b))&&(b===_.S?HB(e,!1).then(function(){a.a.set(b,null);e.trigger(new _.L(_.nl))})["catch"](function(n){a.g.warn("Error while de-activating text tracks",n)}):b===_.T?a.g.info("Enabling ABR for audio is not supported"):b===_.Qj&&h.trickPlay?a.g.info("Enabling ABR for trick play tracks is not supported"):LB(e,null,d))}};
OB=function(a){if(a.m){a.g.debug("Track list change detected, updating track list");for(var b=[],c=_.u(Object.values(_.$t)),d=c.next();!d.done;d=c.next())d=d.value,a.a.set(d,null),a.f.set(d,null);c={};d=_.u(a.m.fa());for(var e=d.next();!e.done;c={ec:c.ec},e=d.next()){e=e.value;c.ec=wB(_.S,e);var f=b.find(function(h){return function(l){return h.ec.ta(l)}}(c));c.ec=f||c.ec;var g=xB(_.S,e,c.ec);e.active&&a.a.set(_.S,g);f||b.push(c.ec)}MB(a.m)||a.a.set(_.S,null);c=KB(a.m);NB(a,b,c,_.Qj);NB(a,b,c,_.T);
a.h=b}};NB=function(a,b,c,d){var e=yB(c,d);c={};e=_.u(e);for(var f=e.next();!f.done;c={fc:c.fc},f=e.next()){f=f.value;c.fc=wB(d,f);var g=b.find(function(l){return function(m){return l.fc.ta(m)}}(c));c.fc=g||c.fc;var h=xB(d,f,c.fc);f.active&&a.a.set(d,h);g||b.push(c.fc)}};
PB=function(a,b,c){if(b){a.h.length||OB(a);for(var d=b.type,e=a.a.get(d)||null,f,g=_.u(CB(a,d)),h=g.next();!h.done&&!(f=h.value.renditions.find(function(l){return l.id==b.id}));h=g.next());f&&e!==f&&(GB(a,f),d===_.T?a.m.trigger(new _.L(_.ml)):d===_.Qj&&a.m.trigger(new _.L(_.wg,{details:{width:f.width||0,height:f.height||0,bandwidth:f.bandwidth,track:f.track,abrSelection:c}})))}};QB=function(){this.f=new _.bA(2);this.h=new _.bA(5);this.a=0};
_.RB=function(){this.g=new _.K("clpp.abr");this.w=null;this.h=!1;this.o=new QB;this.l=[];this.j=1;this.C=this.B=!1;this.A=this.a=this.f=null};SB=function(a,b){a&&(b=b.filter(function(c){return c.video&&c.video.trickPlay?!1:lB(c,a,{width:Infinity,height:Infinity})}));return b.sort(function(c,d){return c.bandwidth-d.bandwidth})};TB=function(){this.a=new Map};VB=function(a,b){a.a.has(b)||a.a.set(b,new UB);return a.a.get(b)};UB=function(){this.text=this.variant=null};
WB=function(a,b){this.f=a;this.a=new Set([a]);b=b||[];for(var c=_.u(b),d=c.next();!d.done;d=c.next())this.add(d.value)};ZB=function(a,b){var c;if(!(c=!!a.audio!=!!b.audio||!!a.video!=!!b.video||a.language!=b.language)&&(c=a.audio&&b.audio)){c=a.audio;var d=b.audio;c=!(c.channelsCount==d.channelsCount&&XB(c,d)&&YB(c.roles,d.roles))}!c&&(c=a.video&&b.video)&&(c=a.video,d=b.video,c=!(XB(c,d)&&YB(c.roles,d.roles)));return c?!1:!0};
XB=function(a,b){if(a.mimeType!=b.mimeType)return!1;var c=a.codecs.split(",").map(function(f){return _.Pz(f)[0]}),d=b.codecs.split(",").map(function(f){return _.Pz(f)[0]});if(c.length!=d.length)return!1;c.sort();d.sort();for(var e=0;e<c.length;e++)if(c[e]!=d[e])return!1;return!0};YB=function(a,b){var c=new Set(a),d=new Set(b);c["delete"](_.He);d["delete"](_.He);if(c.size!=d.size)return!1;c=_.u(c);for(var e=c.next();!e.done;e=c.next())if(!d.has(e.value))return!1;return!0};
aC=function(a){this.a=a;this.f=new $B(a.language,"",a.audio&&a.audio.channelsCount?a.audio.channelsCount:0,!1)};$B=function(a,b,c,d){this.h=_.Th(a);this.a=b;this.f=c;this.j=void 0===d?!1:d};bC=function(a,b){var c=null;b.some(function(d){c=_.Gz(_.Ni(d),a.map(function(e){return Fz(e)}));return!!c});return c?a.filter(function(d){return c===Fz(d)}):[]};cC=function(a,b){return a.filter(function(c){var d=c.audio;c=c.video;return d&&0<=d.roles.indexOf(b)||c&&0<=c.roles.indexOf(b)})};
dC=function(a,b){return a.filter(function(c){return c.audio&&c.audio.spatialAudio!=b?!1:!0})};gC=function(a,b){this.a=eC;this.f=(new Map).set(eC,b).set(fC,a)};
iC=function(a){var b=this;this.D=a;this.a=a.getConfiguration().streaming;this.f=new _.Eh;this.g=new _.K("clpp.mse.media.LiveEdgeObserver");hC(this)&&(a=this.D.getSurface().getMedia(),this.f.on(a,_.eg,function(){var c=b.D.getPosition(),d=b.D.getSeekRange().end;c=d-c;var e=b.D.getPlaybackRate(),f=b.a.stopChasingAt;1<=e&&c>=b.a.chaseJumpDistance?(b.g.debug("Too far from edge, jump to beginning."),b.D.setPlaybackRate(1),b.D.seek(d)):1===e&&c>=b.a.startChasingAt?(b.g.debug("Not on live edge, increase playback rate."),
b.D.setPlaybackRate(b.a.chasingRate,_.Vd)):1<e&&c<=f&&(b.g.debug("On live edge, reduce playback rate."),b.D.setPlaybackRate(1))}))};
hC=function(a){return 1>=a.a.chasingRate?(a.g.warn("chasingRate must be greater than 1."),!1):a.a.chaseJumpDistance<=a.a.startChasingAt?(a.g.warn("chaseJumpDistance must be greater than startChasingAt."),!1):a.a.startChasingAt<=a.a.stopChasingAt?(a.g.warn("startChasingAt must be greater than stopChasingAt."),!1):0>a.a.stopChasingAt?(a.g.warn("stopChasingAt must be greater than or equal to 0."),!1):!0};jC=function(a){this.h=a;this.a=null;this.f=function(){}};kC=function(a,b){a.f=b};
lC=function(a){var b=this;this.f=a;this.o=this.A=this.l=!1;this.h=this.f.Qg();this.w=_.Vd;this.j=null;this.a=new _.uk(function(){b.A||b.f.Pk(.25*b.h)});this.g=new _.K("clpp.mse.media.PlayRateController")};mC=function(a,b){a.j=b;a.j.speedUpMode&&(a.w=a.j.speedUpMode)};
pC=function(a,b){a.a.stop();a.l||(a.o=!1);var c=a.l?0:a.h;if((b?b:a.w)===_.Vd||0===c||1===c)try{nC(a,c)}catch(d){a.g.warn('Set playbackRate using "decoder" mode fails, due to unsupported range by platform. Fallback to "seek" mode.',d),oC(a)}else oC(a)};oC=function(a){a.g.debug(Xy,a.h,' using "seek" mode.');nC(a,0);a.o=!0;a.a.jb(.25)};nC=function(a,b){if(a.f.Qg()!=b){a.g.debug(Xy,b,' using native playbackRate "decoder" mode.');try{a.f.mm(b)}catch(c){throw c;}}};
rC=function(a,b){this.h=a;this.l=qC(a);this.a=a.a.currentTime;this.j=Date.now()/1E3;this.o=b;this.f=function(){}};sC=function(a,b){a.f=b};tC=function(a){this.a=a};qC=function(a){if(a.a.paused||0==a.a.playbackRate||0===a.a.buffered.length)var b=!1;else a:{b=a.a.buffered;a=a.a.currentTime;for(var c=0;c<b.length;c++){var d=b.start(c),e=b.end(c);if(!(a<d-.1||a>e-(c+1===b.length?.5:.1))){b=!0;break a}}b=!1}return b};
vC=function(a,b,c,d,e){var f=this;this.a=a;this.G=b;this.l=c;this.C=e;this.h=new _.Eh;this.B=!1;this.I=a.readyState;this.j=!1;this.f=d;this.o=this.H=this.A=!1;this.h.on(a,_.Ag,function(){return uC(f)});this.w=(new _.uk(function(){uC(f)})).jb(.25)};
uC=function(a){if(0!=a.a.readyState){if(a.a.seeking){if(!a.B)return}else a.B=!1;if(!a.a.paused&&!a.o){a.a.readyState!=a.I&&(a.j=!1,a.I=a.a.readyState);var b=a.l.smallGapLimit,c=a.a.currentTime,d=a.a.buffered;a:{var e=new _.sl(d);var f=a.l.gapDetectionThreshold;if(e.length&&!(1===e.length&&1E-6>e.end(0)-e.start(0)))for(var g=0;g<e.length;g++)if(e.start(g)>c&&(0===g||e.end(g-1)-c<=f)){e=g;break a}e=null}if(null==e){if(a.f){a=a.f;d=a.h;c=qC(d);d=d.a.currentTime;b=Date.now()/1E3;if(a.a!=d||a.l!=c)a.j=
b,a.a=d,a.l=c;d=b-a.j;d>=a.o&&c&&a.f(a.a,d)}}else if((0!=e||a.A)&&a.H&&(f=d.start(e),!(f>=nA(a.G)))){g=f-c;b=g<=b;var h=!1;if(!(.001>g)){if(!b&&!a.j){a.j=!0;var l=new _.L("largegap",{detail:{currentTime:c,gapSize:g}});l.cancelable=!0;a.C(l);a.l.jumpLargeGaps&&!l.defaultPrevented?h=!0:_.sh("Ignoring large gap at",c,"size",g)}if(b||h)0==e?_.sh(Ry,g,"seconds because of gap before start time of",f):_.sh(Ry,g,"seconds because of gap starting at",d.end(e-1),"and ending at",f),a.a.currentTime=f}}}}};
zC=function(a,b,c,d){this.a=a;this.j=b;this.o=d;this.A=c;this.l=!1;this.f=new _.Eh;this.h=new wC(a);this.w=!1;0<a.readyState?xC(this,c):yC(this,c)};AC=function(a){return a.l?a.a.currentTime:a.A};CC=function(a,b){0<a.a.readyState?BC(a.h,b):yC(a,b)};yC=function(a,b){a.A=b;a.f.off(a.a,_.Fe);a.f.one(a.a,_.Fe,function(){xC(a,b)})};xC=function(a,b){a.w||(a.w=!0,a.o&&a.o());.001>Math.abs(a.a.currentTime-b)?DC(a):(a.f.one(a.a,_.Mf,function(){DC(a)}),BC(a.h,0==a.a.currentTime?b:a.a.currentTime))};
DC=function(a){_.zk()&&!a.l&&a.j();a.l=!0;a.f.on(a.a,_.Mf,function(){return a.j()})};wC=function(a){var b=this;this.f=a;this.o=10;this.l=this.h=this.j=0;this.a=new _.uk(function(){0>=b.j?(_.J(["Failed to move playhead from",b.h,"to",b.l].join(" ")),b.a.stop()):b.f.currentTime!=b.h?b.a.stop():(b.f.currentTime=b.l,b.j--)})};BC=function(a,b){a.h=a.f.currentTime;a.l=b;a.j=a.o;a.f.currentTime=b;a.a.jb(.1)};
HC=function(a,b,c,d,e,f){var g=this;this.h=a;this.a=b.presentationTimeline;this.B=b.minBufferTime||0;this.l=c;this.A=e;this.w=null;this.j=new vC(a,b.presentationTimeline,c,EC(this,a,c),f);this.f=new zC(a,function(){a:{var h=g.j;h.B=!0;h.A=!1;h.j=!1;h=AC(g.f);var l=FC(g,h);if(.001<Math.abs(l-h)){var m=(new Date).getTime()/1E3;if(!g.w||g.w<m-1){g.w=m;CC(g.f,l);h=void 0;break a}}g.g.debug("Seek to "+h);g.A();h=void 0}return h},GC(this,d),function(){g.j.H=!0});this.o=(new _.uk(function(){if(0!=g.h.readyState&&
!g.h.paused){var h=AC(g.f),l=_.oA(g.a,0),m=nA(g.a);3>m-l&&(l=m-3);h<l&&(l=FC(g,h),g.g.info("Jumping forward "+(l-h)+" seconds to catch up with the seek range."),g.h.currentTime=l)}})).jb(.25);this.g=new _.K("clpp.mse.Playhead")};JC=function(a){var b=AC(a.f);return 0<a.h.readyState&&!a.h.paused?IC(a,b):b};GC=function(a,b){null==b?b=Infinity>a.a.getDuration()?_.oA(a.a,0):nA(a.a):0>b&&(b=nA(a.a)+b);return KC(a,IC(a,b))};KC=function(a,b){var c=a.a.getDuration();return b>=c?c-a.l.durationBackoff:b};
FC=function(a,b){var c=new _.sl(a.h.buffered);c=c.qc.bind(c);var d=Math.max(a.B,a.l.rebufferingGoal),e=a.l.safeSeekOffset,f=_.oA(a.a,0),g=nA(a.a),h=a.a.getDuration();3>g-f&&(f=g-3);var l=_.oA(a.a,d),m=_.oA(a.a,e);d=_.oA(a.a,d+e);if(b>=h)return a.g.debug("Playhead past duration."),KC(a,b);if(b>g)return a.g.debug("Playhead past end."),g;if(b<f){if(c(m))return a.g.debug("Playhead before start \x26 start is buffered"),m;a.g.debug("Playhead before start \x26 start is unbuffered");return d}if(b>=l||c(b))return a.g.debug("Playhead in safe region or in buffered region."),
b;a.g.debug("Playhead outside safe region \x26 in unbuffered region.");return d};IC=function(a,b){var c=_.oA(a.a,0);if(b<c)return c;c=nA(a.a);return b>c?c:b};
EC=function(a,b,c){if(!c.stallEnabled)return null;var d=c.gapDetectionThreshold,e=c.stallSkip;c=new rC(new tC(b),c.stallThreshold);sC(c,function(f,g){a.g.warn("Stall detected at "+f+" for "+g+" seconds.");if(e){var h=new _.sl(b.buffered),l;if(l=_.xk("Edge/")||_.xk("Trident/")||_.Dj()||_.zk())a:{if(h.length&&!(1>=h.length))for(l=0;l<h.length-1;l++)if(f>h.start(l)&&f<h.end(l)){l=h.start(l+1)-h.end(l)>=d;break a}l=!1}if(l){a:{if(h.length&&!(1>=h.length))for(l=0;l<h.length-1;l++)if(f>h.start(l)&&f<h.end(l)){h=
h.start(l+1)-f;break a}h=null}h&&(e=Math.min(h+.1,e))}a.g.warn("Seeking forward "+e+" seconds to break stall.");b.currentTime+=e}else a.g.warn("Pausing and unpausing to break stall."),b.pause(),b.play()});return c};
MC=function(a){function b(){d=!0}function c(m){f.push(m);_.nm(m)}a=_.Ui(a);var d=!1,e,f=[],g=[];(new _.mm).L(_.Oe,c).L(_.fg,c).L(_.Je,c).L(_.Ne,c).L(_.Vf,c).Y(_.Xf,function(m){e=m;f.push(m);_.om(m)}).Y("encv",b).Y("enca",b).Y("avc1",function(m){g.push({L:m,Zc:1701733238})}).Y("avc3",function(m){g.push({L:m,Zc:1701733238})}).Y("ac-3",function(m){g.push({L:m,Zc:1701733217})}).Y("ec-3",function(m){g.push({L:m,Zc:1701733217})}).Y("mp4a",function(m){g.push({L:m,Zc:1701733217})}).parse(a);if(d)return _.sh("Init segment already indicates encryption."),
a;if(0===g.length||!e)throw _.uh("Failed to find boxes needed to fake encryption!"),_.uh("Failed init segment (hex):",_.hj(a)),new _.P(_.Q,3,14E3);g.reverse();for(var h=_.u(g),l=h.next();!l.done;l=h.next())l=l.value,_.sh('Inserting "'+_.rm(l.Zc)+'" box into init segment.'),a=LC(a,e,l.L,f,l.Zc);return a};
LC=function(a,b,c,d,e){var f=NC.value(),g=a.subarray(c.start,c.start+c.size),h=_.aj(g),l=new Uint8Array(c.size+f.byteLength);l.set(g,0);g=_.aj(l);g.setUint32(4,e);l.set(f,c.size);e=h.getUint32(4);g.setUint32(c.size+16,e);OC(l,0,l.byteLength);e=new Uint8Array(a.byteLength+l.byteLength);c=_.xk("Xbox One")||_.wk()?c.start:c.start+c.size;f=a.subarray(c);e.set(a.subarray(0,c));e.set(l,c);e.set(f,c+l.byteLength);a=_.u(d);for(d=a.next();!d.done;d=a.next())d=d.value,OC(e,d.start,d.size+l.byteLength);l=_.aj(e,
b.start);b=_.sm(b);a=l.getUint32(b);l.setUint32(b,a+1);return e};OC=function(a,b,c){a=_.aj(a,b);b=a.getUint32(0);0!=b&&(1==b?(a.setUint32(8,c>>32),a.setUint32(12,c&4294967295)):a.setUint32(0,c))};_.PC=function(a,b){this.D=b;this.j=a;this.h=null;this.w=1;this.G=Promise.resolve();this.l=[];this.o=new Map;this.a=new Map;this.I=this.f=this.A=this.B=!1;this.H=0;this.g=new _.K("clpp.mse.Streaming");this.C=!1};RC=function(a){var b=a.a.get(_.sg);return b?QC(a)[b.Fb]:(b=a.a.get(_.$c))?QC(a)[b.Fb]:null};
TC=function(a){return _.SC(a,_.$c)};UC=function(a){return _.SC(a,_.sg)};
ZC=function(a,b){var c,d,e,f,g,h,l,m,n,p;return _.E(function(q){switch(q.a){case 1:return c=_.fp,_.x(q,a.D.X.clear(c.TEXT),2);case 2:return a.H++,a.I=!1,d=a.H,e=a.D.X,f=new Map,g=new Set,f.set(c.TEXT,b),g.add(b),_.x(q,e.init(f,!1,a.h.disableAudioTracks),3);case 3:return a.f?q["return"]():_.x(q,VC(a,g),4);case 4:if(a.f)return q["return"]();l=(h=e.getTextDisplayer().isTextVisible())||a.h.alwaysStreamText;a.H!=d||a.a.has(c.TEXT)||a.I||!l||(m=a.D.Cb(),n=WC(a,m),p=XC(b,n,0),a.a.set(c.TEXT,p),YC(a,p,0));
_.y(q)}})};bD=function(a){a.I=!0;var b=a.a.get(_.bg);b&&($C(b),aD(b)["catch"](function(){}),a.a["delete"](_.bg))};dD=function(a,b,c,d){b.video&&_.cD(a,b.video,c,d);b.audio&&_.cD(a,b.audio,c,d)};
fD=function(a){function b(l){return a.D.X.qc(l,c,0)}var c=a.D.Cb(),d=!1,e=WC(a,c);if(_.Ri(a.a.values(),function(l){return l.Fb==e}))for(var f=_.u(a.a.keys()),g=f.next();!g.done;g=f.next()){g=g.value;var h=a.a.get(g);h.stream.segmentIterator=null;b(g)||(eD(a,h),d=!0)}else if(!_.Ri(a.a.keys(),b)){a.g.debug("(all): seeked: unbuffered seek: clearing all buffers");d=_.u(a.a.values());for(f=d.next();!f.done;f=d.next())eD(a,f.value);d=!0}d||a.g.debug("(all): seeked: buffered seek: presentationTime\x3d"+
c)};iD=function(a,b){b=void 0===b?!1:b;if(a.f)a.g.error("Unable to retry after StreamingEngine is destroyed!");else if(a.A)a.g.error("Unable to retry after StreamingEngine encountered a fatal error!");else for(var c=_.u(a.a.values()),d=c.next();!d.done;d=c.next()){d=d.value;var e=gD(d);if(d.Uc||b&&hD(d))a.g.info(e,"Retrying after failure..."),d.Uc=!1,YC(a,d,.1)}};
kD=function(a){var b,c,d,e;return _.E(function(f){b=[];c=_.u(a.a.values());for(d=c.next();!d.done;d=c.next())e=d.value,$C(e),e.eb&&e.Ib&&(e.eb=!1,b.push(e.Ib.abort())),e.Mb&&b.push(jD(a,e,!0,0));return _.x(f,Promise.all(b),0)})};lD=function(a,b,c){(a=a.a.get(b))&&c&&($C(a),a.stream=c,a.Xb=c,a.va&&(a.va=c.getSegmentReference(a.va.position)),a.va||(a.Xb=null))};_.SC=function(a,b){var c=a.a.get(b);return c?c.ac||c.stream:null};
_.cD=function(a,b,c,d){var e=a.a.get(b.type);if(!e&&b.type==_.bg&&a.h.ignoreTextStreamFailures)ZC(a,b);else if(e){var f=Zz(QC(a),b);if(c&&f!=e.Fb)for(a.g.debug("switch: switching to stream in another Period; clearing buffer and changing Periods"),b=_.u(a.a.values()),c=b.next();!c.done;c=b.next())eD(a,c.value);else{e.ac&&(a.g.debug("switch during trick play mode",b),b.trickModeVideo?(e.ac=b,b=b.trickModeVideo,a.g.debug("switch found trick play stream",b)):(e.ac=null,a.g.debug("switch found no special trick play stream")));
var g=a.l[f];if(g&&g.cd&&(g=a.o.get(b.id))&&g.cd)if(e.stream!=b){g=a.j.presentationTimeline.getDuration();var h=a.D.Cb();h=mD(a,e,h);!c&&(e.endOfStream||h>=g)?a.g.debug(pz+gD(e)+" already buffered to the end. Not switching."):(b.type==_.bg&&RA(a.D.X,_.rk(b.mimeType,b.codecs)),e.stream=b,e.stream.segmentIterator=null,e.Ld=!0,a.g.debug("switch: switching to Stream "+gD(e)),nD(a,e,f)&&(a.g.info("Aborting current segment request to switch."),e.Ib.abort()),c&&(e.hc?e.Ee=!0:e.eb?(e.Mb=!0,e.ae=d,e.Ee=!0):
($C(e),jD(a,e,!0,d)["catch"](function(l){if(a.D)a.D.onError(l)}))))}else a.g.debug(pz+gD(e)+" already active")}}};nD=function(a,b,c){if(!b.Ib)return!1;var d=a.D.Cb(),e=a.D.X.Fa(b.type);c=(c=oD(a,b,d,e,c))?c.ia?c.ia-c.wa+1:null:null;if(null==c)return!1;var f=b.stream.initSegmentReference;f&&(c+=(f.ia?f.ia-f.wa+1:null)||0);f=a.D.ef().getBandwidthEstimate();if(8*c/f<(null===e?0:e-d)-Math.max(a.j.minBufferTime||0,a.h.rebufferingGoal))return!0;a=b.Ib;a=a.j?a.j.bytesRemaining:-1;return 0>a||a>c?!0:!1};
eD=function(a,b){var c=gD(b);b.hc?a.g.debug(c,"clear: already clearing the buffer"):b.Mb?a.g.debug(c,"clear: already waiting"):b.eb?(a.g.debug(c,"clear: currently updating"),b.Mb=!0,b.ae=0):null==a.D.X.wb(b.type)?(a.g.debug(c,"clear: nothing buffered"),null==b.vb&&YC(a,b,0)):(a.g.debug(c,"clear: handling right now"),$C(b),jD(a,b,!1,0)["catch"](function(d){if(a.D)a.D.onError(d)}))};
qD=function(a,b,c,d,e){var f,g,h,l,m,n,p;return _.E(function(q){if(1==q.a)return f=a.D.Cb(),g=WC(a,f),h=_.fp,l=new Map,m=new Set,b&&(l.set(h.AUDIO,b),m.add(b)),c&&(l.set(h.VIDEO,c),m.add(c)),d&&(l.set(h.TEXT,d),m.add(d)),n=a.D.X,p=a.h.forceNativeTS,_.x(q,n.init(l,p,a.h.disableAudioTracks),2);if(3!=q.a){if(a.f)return q["return"]();pD(a);return _.x(q,VC(a,m),3)}if(a.f)return q["return"]();l.forEach(function(t,v){if(!a.a.has(v)){var z=XC(t,g,e);a.a.set(v,z);YC(a,z,0)}});_.y(q)})};
XC=function(a,b,c){return{stream:a,type:a.type,Xb:null,segmentIterator:null,va:null,ac:null,Ld:!0,Fb:b,endOfStream:!1,eb:!1,vb:null,Mb:!1,ae:0,Ee:!1,hc:!1,If:!1,Uc:!1,Jh:c||0,Ib:null,de:!1,fh:0}};
rD=function(a,b){var c=a.l[b];if(c)return a.g.debug("(all) Period "+b+Ky),c.O;a.g.debug("(all) setting up Period "+b);c={O:new _.wj,cd:!1};a.l[b]=c;for(var d=new Set,e=_.u(QC(a)[b].variants),f=e.next();!f.done;f=e.next())f=f.value,f.video&&d.add(f.video),f.video&&f.video.trickModeVideo&&d.add(f.video.trickModeVideo),f.audio&&d.add(f.audio);e=_.u(QC(a)[b].textStreams);for(f=e.next();!f.done;f=e.next())d.add(f.value);a.G=a.G.then(function(){return a.f?null:VC(a,d)}).then(function(){a.f||(a.l[b].O.resolve(),
a.l[b].cd=!0,a.g.debug("(all) setup Period "+b))})["catch"](function(g){a.f||(a.l[b].O["catch"](function(){}),a.l[b].O.reject(),delete a.l[b],a.g.warn("(all) failed to setup Period "+b),a.D.onError(g))});return c.O};
VC=function(a,b){var c,d,e,f,g,h,l,m,n,p,q;return _.E(function(t){switch(t.a){case 1:c=[];d=_.u(b);for(e=d.next();!e.done;e=d.next())f=e.value,(g=a.o.get(f.id))?(a.g.debug("(all) Stream "+f.id+Ky),c.push(g.O)):(a.g.debug("(all) setting up Stream "+f.id),a.o.set(f.id,{O:new _.wj,cd:!1}),c.push(f.createSegmentIndex()));_.A(t,2);return _.x(t,Promise.all(c),4);case 4:if(a.f)return t["return"]();_.ah(t,3);break;case 2:h=_.C(t);if(a.f)return t["return"]();l=_.u(b);for(e=l.next();!e.done;e=l.next())m=e.value,
a.o.get(m.id).O["catch"](function(){}),a.o.get(m.id).O.reject(),a.o["delete"](m.id);throw h;case 3:n=_.u(b);for(e=n.next();!e.done;e=n.next())p=e.value,q=a.o.get(p.id),q.cd||(q.O.resolve(),q.cd=!0,a.g.debug("(all) setup Stream "+p.id));_.y(t)}})};pD=function(a){var b=a.j.presentationTimeline.getDuration();Infinity>b?cB(a.D.X,b):cB(a.D.X,Math.pow(2,32))};
uD=function(a,b){function c(p){return p.type==_.bg&&p.stream.mimeType==_.Sc}if(c(b))return YA(a.D.X,b.stream.originalId||""),null;b.type==_.bg&&ZA(a.D.X);if(!QA(a.D.X)&&b.type!=_.bg)return a.h.bufferLimitUpdateInterval?a.h.bufferLimitUpdateInterval/2:.5;var d=gD(b),e=a.D.Cb(),f=mD(a,b,e);a.g.debug(d,"timeNeeded\x3d"+f);var g=Zz(QC(a),b.stream),h=WC(a,f),l=a.D.X.Na(b.type,e);a.g.debug(d,"update_:",kz+e,"bufferedAhead\x3d"+l);var m=Math.max(a.j.minBufferTime||0,a.h.rebufferingGoal,a.h.bufferingGoal)*
a.w,n=gA(a.j.presentationTimeline);if(null!=n&&f>=n&&!b.de)return sD(a,b),null;b.endOfStream=!1;b.Fb=h;if(h!=g)return a.g.debug(d,"need Period "+h,kz+e,"timeNeeded\x3d"+f,"currentPeriodIndex\x3d"+g),null;if(l>=m)return a.g.debug(d,"buffering goal met"),a.h.bufferLimitUpdateInterval||.5;h=a.D.X.Fa(b.type);h=oD(a,b,e,h,g);if(!h)return a.j.presentationTimeline.isLive()||b.type===_.bg?a.h.bufferLimitUpdateInterval||1:(a.g.debug("Media state "+d+": no next segment found. Assuming EOS."),sD(a,b),null);
d=Infinity;l=_.u(a.a.values());for(m=l.next();!m.done;m=l.next())m=m.value,c(m)||(m=mD(a,m,e),d=Math.min(d,m));if(f>=d+a.j.presentationTimeline.a)return a.h.bufferLimitUpdateInterval||1;b.Jh=0;tD(a,b,e,g,h)["catch"](function(){});return null};sD=function(a,b){a.g.debug(gD(b),"buffered to end of presentation");b.endOfStream=!0;if(b.type==_.sg){var c=a.a.get(_.bg);c&&c.stream.mimeType==_.Sc&&(c.endOfStream=!0)}};
mD=function(a,b,c){if(!b.Xb||!b.va)return Math.max(c,b.Jh);c=Zz(QC(a),b.Xb);return QC(a)[c].startTime+b.va.endTime};
oD=function(a,b,c,d,e){if(b.stream.segmentLookupStrategy===vD)b.stream.segmentIterator?a=tA(b.stream.segmentIterator):b.va||d?(c=b.va?b.va.endTime:d,a.g.info(Qy,"looking up segment from new stream endTime:",c),b.stream.segmentIterator=xA(b.stream.segmentIndex,c),e=b.stream.segmentIterator.next().value,null===e&&(b.stream.segmentIterator=null,a.g.warn(Qy,bz,"endTime:",c,b.va)),a=e):(e=Math.max(c,0),a.g.info(Qy,"looking up segment","lookupTime:",e,jz,c),d=null,d||(b.stream.segmentIterator=xA(b.stream.segmentIndex,
c),d=b.stream.segmentIterator.next().value),null===d&&a.g.warn(Qy,bz,"lookupTime:",e,jz,c),a=d);else{var f=gD(b);if(b.va&&b.stream==b.Xb)c=b.va.position+1,a.g.debug(f,"next position known:","position\x3d"+c),a=wD(a,b,e,c);else{if(b.va){a.g.debug(f,"next position unknown: another Stream buffered");f=Zz(QC(a),b.Xb);var g=xD(a,b,QC(a)[f].startTime+b.va.endTime,e)}else a.g.debug(f,"next position unknown: nothing buffered"),g=xD(a,b,d||c,e);if(null==g)a=null;else if(f=wD(a,b,e,g),null==f)a=null;else{var h=
null==a.h?!1:a.h.ignoreDrift;null!=d||h||(d=f,d.ya+d.startTime+2>c&&(a=wD(a,b,e,Math.max(0,g-1)))&&(f=a));a=f}}}return a};xD=function(a,b,c,d){var e=gD(b);d=QC(a)[d];var f=Math.max(0,c-d.startTime);b=b.stream.findSegmentPosition(f);a.g.debug(e,"Looked up segment:",kz+c,"lookupTime\x3d"+f,dz+d.startTime,"Result: segment position\x3d"+b);null==b&&a.g.warn(e,"cannot find segment:",dz+d.startTime,"lookupTime\x3d"+f);return b};
wD=function(a,b,c,d){var e=gD(b);c=QC(a)[c];var f=b.stream.getSegmentReference(d);if(!f)return a.g.debug(e,"segment does not exist:",dz+c.startTime,"position\x3d"+d),null;var g=a.j.presentationTimeline;d=_.mA(g);g=lA(g);return!b.de&&(c.startTime+f.endTime<d||c.startTime+f.startTime>g)?(a.g.debug(e,"segment is not available:",dz+c.startTime,nz+f.startTime,lz+f.endTime,"availabilityStart\x3d"+d,"availabilityEnd\x3d"+g),null):f};
tD=function(a,b,c,d,e){var f,g,h,l,m,n,p,q,t,v,z,D,G;return _.E(function(F){f=_.fp;g=gD(b);h=QC(a)[d];a.g.debug(g,"fetchAndAppend_:",kz+c,dz+h.startTime,mz+e.position,nz+e.startTime,lz+e.endTime);l=b.stream;m=b.stream.segmentIterator;n=a.j.presentationTimeline.getDuration();p=QC(a)[d+1];q=Math.max(0,h.startTime-.1);t=p?p.startTime+.01:n;v=yD(a,b,d,q,t,e);b.eb=!0;b.Ld=!1;a.g.debug(g,"fetching segment");z=!1;D=function(B,I){if(a.f||a.A)return null;z=!0;return zD(a,b,c,h,l,e,B,I)};G=a.D.X.Fa(b.type)||
0;v.then(function(){return a.f||a.A?null:AD(a,b,e,!1,function(B){return D(B.data,!0)})}).then(function(B){return a.f||a.A?null:z||null===B?(BD(a,b,G,e,l),null):D(B,!1)}).then(function(){if(!a.f&&!a.A){BD(a,b,G,e,l);b.eb=!1;b.If=!1;b.Mb||a.D.xe();if(m){var B=m.next().value;B&&a.g.debug("New iterated segment",B)}YC(a,b,0);CD(a,b,l);a.g.debug(g,"finished fetch and append")}})["catch"](function(B){return _.E(function(I){if(a.f||a.A)return I["return"]();b.eb=!1;if(b.type==f.TEXT&&a.h.ignoreTextStreamFailures)return 1001==
B.code?a.g.warn(g,"Text stream failed to download. Proceeding without it."):a.g.warn(g,"Text stream failed to parse. Proceeding without it."),a.a["delete"](f.TEXT),I.F(0);if(7001==B.code)return b.eb=!1,b.vb=null,YC(a,b,0),I.F(0);if(3017===B.code)return DD(a,b,B),I.F(0);if(1001===B.code&&B.data&&404===B.data[1])return a.g.warn(g,"request for segment failed","segment not available on server",mz+e.position,nz+e.startTime,lz+e.endTime,"error\x3d"+B),b.eb=!1,b.vb=null,YC(a,b,1),I.F(0);if(b.type===f.TEXT)return B instanceof
_.P&&B.a(1),$C(b),a.D.onError(new _.P(1,2,2010,B)),I.F(0);if(1001<=B.code&&1003>=B.code)return _.x(I,ED(a,b,h,B),0);a.g.error(g,"failed fetch and append: code\x3d"+B.code);b.Uc=!0;B instanceof _.P&&B.a(_.Q);return _.x(I,FD(a,B),0)})});_.y(F)})};
DD=function(a,b,c){var d=gD(b);if(Array.from(a.a.values()).some(function(f){return f!=b&&f.If}))a.g.debug(d,Sy,"waiting for another stream to recover...");else{var e=Math.round(100*a.w);if(20<e)a.w-=.2;else if(4<e)a.w-=.04;else{a.g.error(d,"MediaSource threw QuotaExceededError too many times");b.Uc=!0;a.A=!0;a.D.onError(c);return}a.g.warn(d,Sy,"reducing buffering goals by "+(100-Math.round(100*a.w))+"%");b.If=!0}YC(a,b,4)};
ED=function(a,b,c,d){var e,f;return _.E(function(g){e=1001===d.code&&500<=d.data.status;f=!0;e||(f=!a.D.Se(b.stream,c));if(!f)return g.F(0);b.Uc=!0;d.a(_.Q);return _.x(g,FD(a,d),0)})};
yD=function(a,b,c,d,e,f){c=QC(a)[c].startTime-f.ya;if(!b.Ld&&c===b.fh)return Promise.resolve();b.fh=c;var g=gD(b);a.g.debug(g,"setting timestamp offset to "+c);a.g.debug(g,"setting append window start to "+d);a.g.debug(g,"setting append window end to "+e);d=aB(a.D.X,b.type,c,d,e);if(!b.stream.initSegmentReference||!b.Ld)return d;a.g.debug(g,"fetching init segment");e=AD(a,b,b.stream.initSegmentReference,!0).then(function(h){if(a.f)return null;a.g.debug(g,"appending init segment");return GD(a,h,b).then(function(){return XA(a.D.X,
b.type,h,null,null,!!b.stream.closedCaptions&&0<b.stream.closedCaptions.size)})})["catch"](function(h){b.Ld=!0;return Promise.reject(h)});return Promise.all([d,e])};GD=function(a,b,c){var d;return _.E(function(e){if(!a.h.patchEdgeWhenMixedContent||!_.wk())return e.F(0);d=MC(b);return _.x(e,XA(a.D.X,c.type,d.buffer,null,null,!!c.stream.closedCaptions&&0<c.stream.closedCaptions.size),0)})};
zD=function(a,b,c,d,e,f,g,h){h=void 0===h?!1:h;var l,m,n,p,q,t,v,z,D;return _.E(function(G){switch(G.a){case 1:l=gD(b);if(!(e&&e.keyId&&a.D.vd)){G.F(2);break}m=wz(a.D.vd,e.keyId);if(!m){a.g.warn("Unable to find DRM session for "+e.keyId);G.F(2);break}_.A(G,4);return _.x(G,m,6);case 6:_.ah(G,2);break;case 4:n=_.C(G),a.g.warn("DRM session load failed!",n);case 2:if(!(e.encrypted&&e.keyId&&a.D.vd&&yz(a.D.vd,e.keyId))){G.F(7);break}$C(b);p=Zz(QC(a),e);q=HD(a,p);if(!q){G.F(8);break}return _.x(G,q,8);case 8:return t=
a.D.Se(e,d,fz),v=f.startTime+d.startTime,z=f.endTime+d.startTime,a.g.warn(l,"Blocked append for "+v+" - "+z+": "+t+". Stream with Key ID "+(e.keyId+" has restrictions.")),G["return"](Promise.resolve());case 7:return D=e.closedCaptions&&0<e.closedCaptions.size,null!=e.emsgSchemeIdUris&&0<e.emsgSchemeIdUris.length&&(new _.mm).Y("emsg",a.Jl.bind(a,d,f,e.emsgSchemeIdUris)).parse(g),G["return"](ID(a,b,c).then(function(){if(a.f)return null;var F=f.startTime+d.startTime,B=f.endTime+d.startTime;a.g.debug(l,
"Appending segment with "+(F.toFixed(3)+" - "+B.toFixed(3)+" KeyID: ")+(e.keyId+" Width: ")+(e.width+" Height: "+e.height+" Bitrate: ")+(_.R.Re(e.bandwidth)+" Fragment: ")+h);return XA(a.D.X,b.type,g,F,B,D,e.id,h)}).then(function(){a.f||(a.g.debug(l,"appended media segment"),b.Xb=e,b.va=f)}))}})};
BD=function(a,b,c,d,e){if(!a.j.presentationTimeline.isLive()&&b.type!==_.bg){var f=gD(b),g=(a.D.X.Fa(b.type)||0)-c,h=d.endTime-d.startTime;c=g-h;if(Math.abs(c)>=Math.min(.01,h)&&Math.abs(c)<=Math.min(1,h))for(a.g.debug(f,"Adjusted segment",d.position,"with real duration",g,"and accounted for",c,"delta between segment duration and real duration"),b.de=!0,a=QC(a),e.adjustSegmentDurations(d.position,c),d=Zz(a,e),b=a[d],e=e.getDuration(),aA(b,e),e=d+1;e<a.length;e++)a[e].startTime+=c}};
JD=function(a,b,c){(new _.mm).L(_.Oe,_.nm).L(_.fg,_.nm).L(_.Je,_.nm).L(_.Ne,_.nm).L(_.Vf,_.nm).Y(_.Xf,_.om).L("encv",function(d){d.reader.skip(78);_.nm(d)}).L(_.Qf,_.nm).L("schi",_.nm).L("tenc",function(d){d.reader.skip(6);if(_.gm(d.reader)){d.reader.skip(1);var e=_.hj(_.lm(d.reader,16));e!==b.stream.keyId&&(a.g.debug(gD(b),"Key id from tenc mismatches with key id from manifest. Switching from "+(b.stream.keyId+" to "+e+".")),b.stream.keyId=e)}d.parser.stop()}).parse(c)};
ID=function(a,b,c){if(a.f)return Promise.resolve();var d=gD(b);a.g.debug(d,"checking buffer length");var e=Math.max(a.h.bufferBehind,a.j.presentationTimeline.a),f=a.D.X.wb(b.type);if(null==f)return a.g.debug(d,"buffer behind okay because nothing buffered:",kz+c,Zy+e),Promise.resolve();var g=c-f,h=g-e;if(.01>=h)return a.g.debug(d,"buffer behind okay:",kz+c,$y+g,Zy+e,"underflow\x3d"+Math.abs(h)),Promise.resolve();a.g.debug(d,"buffer behind too large:",kz+c,$y+g,Zy+e,"overflow\x3d"+h);return a.D.X.remove(b.type,
f,f+h).then(function(){a.f||a.g.debug(d,"evicted "+h+" seconds")})};CD=function(a,b,c){if(!a.B){b=gD(b);var d=Array.from(a.a.values());1!=d.length||d[0].type!=_.bg?a.B=d.every(function(e){return e.type==_.bg||a.C?!0:!e.Mb&&!e.hc&&e.va}):a.C&&(a.B=!0);a.B&&(a.g.debug(b,"startup complete"),c=Zz(QC(a),c),HD(a,c))}};
HD=function(a,b){var c=null;a.l[b]||(c=rD(a,b).then(function(){a.f||(a.g.debug(az),a.D.vf())})["catch"](Bz));for(var d=0;d<QC(a).length;++d)rD(a,d)["catch"](Bz);a.D.Dl&&(a.g.debug("calling onStartupComplete()..."),a.D.Dl());return c};
KD=function(a,b){var c=gD(b),d=Zz(QC(a),b.stream);if(b.Fb!=d){var e=b.Fb,f=Array.from(a.a.values());f.every(function(g){return g.Fb==e})?f.every(hD)?(a.g.debug(c,"all need Period "+e),rD(a,e).then(function(){if(!a.f)if(f.every(function(n){var p=hD(n),q=Zz(QC(a),n.stream);return p&&n.Fb==e&&q!=e})){var g=QC(a)[e];a.g.debug(c,"Streaming period",e,g);a.g.debug(c,"calling onChooseStreams()...");var h=a.D.wf(g);a.C=!h.variant&&!!h.text;var l=new Map;h.variant&&h.variant.video&&l.set(_.sg,h.variant.video);
h.variant&&h.variant.audio&&l.set(_.$c,h.variant.audio);h.text&&l.set(_.bg,h.text);var m=_.u(a.a.keys());for(h=m.next();!h.done;h=m.next())if(h=h.value,!l.has(h)&&h!=_.bg){a.g.error(c,"invalid Streams chosen: missing "+h+" Stream");a.D.onError(new _.P(_.Q,5,5005));return}m=_.u(Array.from(l.keys()));for(h=m.next();!h.done;h=m.next())if(h=h.value,!a.a.has(h))if(h==_.bg)qD(a,null,null,l.get(_.bg),g.startTime),l["delete"](h);else{a.g.error(c,"invalid Streams chosen: unusable "+h+" Stream");a.D.onError(new _.P(_.Q,
5,5005));return}g=_.u(Array.from(a.a.keys()));for(h=g.next();!h.done;h=g.next())h=h.value,(m=l.get(h))?(_.cD(a,m,!1,0),YC(a,a.a.get(h),0)):a.a["delete"](h);a.g.debug(c,az);a.D.vf()}else a.g.debug(c,"ignoring transition to Period",e,"since another is happening")})["catch"](Bz)):a.g.debug(c,"all MediaStates need Period "+e+", but not all MediaStates are idle"):a.g.debug(c,"not all MediaStates need Period "+e)}};WC=function(a,b){var c=Xz(QC(a),b+_.Tt);return c?QC(a).indexOf(c):0};
AD=function(a,b,c,d,e){d=void 0===d?!1:d;e=void 0===e?null:e;var f=_.eA(c.Sa(),c.wa,c.ia,a.h.attemptParameters,c.startTime,c.endTime,b.type,c.timescale);f.type=2;f.onFragment=c.Oc?null:e;f.disableFragmentSupport=c.Oc||a.h.disableFragmentSupport;f.disableMergedFragments=a.h.disableMergedFragments;if(e=c.f())f.keyInfo=e,f.onFragment=null;d&&(f.responseModifiers.push(function(g){JD(a,b,g.data)}),b.type===_.sg&&a.h.overridePasp&&f.responseModifiers.push(a.Am.bind(a)));a.g.debug("fetching: reference\x3d",
c);c=a.D.Gb.fetch(f);b.Ib=c;return c.O.then(function(g){var h=a.D.ef(),l=g.timeMs,m=g.data.byteLength;l&&m&&!d&&h.segmentDownloaded(l,m);b.Ib=null;return g.data})};
jD=function(a,b,c,d){var e,f,g,h;return _.E(function(l){if(1==l.a)return e=gD(b),b.Mb=!1,b.Ee=!1,b.ae=0,b.hc=!0,b.stream.segmentIterator=null,a.g.debug(e,"clearing buffer"),d?(g=a.D.Cb(),h=a.D.X.getDuration(),f=a.D.X.remove(b.type,g+d,h)):f=a.D.X.clear(b.type).then(function(){return!a.f&&c?a.D.X.flush(b.type):null}),_.x(l,f,2);if(a.f)return l["return"]();a.g.debug(e,"cleared buffer");b.Xb=null;b.va=null;b.hc=!1;b.endOfStream=!1;b.de=!1;YC(a,b,0);_.y(l)})};
YC=function(a,b,c){a.g.debug(gD(b),"updating in "+c+" seconds");b.vb=(new _.sk(function(){var d;return _.E(function(e){if(1==e.a)return _.A(e,2),_.x(e,a.Hb(b),4);if(2!=e.a)return _.ah(e,0);d=_.C(e);if(a.D)a.D.onError(d);_.y(e)})})).aa(c)};$C=function(a){null!=a.vb&&(a.vb.stop(),a.vb=null)};QC=function(a){return a.j.adaptedPeriods||a.j.periods};aD=function(a){return _.E(function(b){return a.Ib?_.x(b,a.Ib.abort(),0):b.F(0)})};
FD=function(a,b){var c;return _.E(function(d){switch(d.a){case 1:if(a.f)return d["return"]();if(!a.D.Nh){d.F(2);break}_.A(d,3);return _.x(d,a.D.Nh(b),5);case 5:_.ah(d,2);break;case 3:c=_.C(d),c.cause=b,b=c;case 2:if(!b.f)a.D.onError(b);_.y(d)}})};gD=function(a){return"("+a.type+":"+a.stream.id+")"};hD=function(a){return!a.eb&&null==a.vb&&!a.Mb&&!a.hc};
ND=function(a){_.Dl.call(this,cz);var b=this;this.G=LD;this.j=this.Yb=this.ha=null;this.Hf=0;this.Eh=2;this.wd=null;this.tf=!1;this.o=new _.Eh;this.Gc=this.oe=this.K=this.Kc=this.A=this.M=this.l=null;this.sd=!1;this.I=this.h=this.f=this.B=this.a=this.gc=this.H=null;this.Uh=1E9;this.qe=new Set;this.ea=!0;this.Da=null;this.Oh=!1;this.Kh=0;this.pa=null;this.V=new TB;this.Sh={width:Infinity,height:Infinity};this.J=null;this.qa=_.Ho;this.Ic=new $B(this.configuration.preferredAudioLanguage||[],this.configuration.preferredAudioRole,
this.configuration.preferredAudioChannelCount,this.configuration.preferSpatialAudio);this.md=this.configuration.preferredTextLanguage;this.da=this.Jc=null;this.Cc=new Map;this.Ma=null;this.ne=this.configuration.preferredTextRole;this.ld=this.configuration.preferForcedSubtitles;a&&a(this);this.Df=null;this.o.on(window,"online",function(){b.G===MD&&iD(b.a)});this.re=null};
OD=function(a){return new _.Sz(function(b){if(void 0===b||null===b)return null;var c=a.getTrackManager(),d=[];if(c){c=_.u(c.getVideoTracks());for(var e=c.next();!e.done;e=c.next())d.push.apply(d,_.Og(e.value.renditions))}return d.find(function(f){return f.id==b})||null})};
PD=function(a,b){if(a.qa!==b){var c=_.R.Nj;if(a.qa===_.So&&b!==_.Ho)c=c(b,_.Qo),a.log.info(_.Uy+c);else{var d=a.Hf;d=0===d?0:Date.now()-d;var e=a.qa;a.qa=b;a.Hf=Date.now();null!==a.K&&(a.K.A=b===_.Uo);a.J&&_.xo(a.J.a,a.qa);b===_.Mo&&(a.Eh=a.rf?1:2);var f=a.Eh,g={currentState:a.qa,previousState:e,timeSinceLastStateChangeMS:d,reason:b===_.Mo||e===_.Mo?f:void 0},h=c(e,_.Qo),l=c(b,_.Qo);c=b!==_.Mo?"":"["+c(f,_.Po)+"]";a.log.info(_.Kb+h+" -\x3e "+(l+c));a.trigger(new _.L(_.Tf,{detail:g}));(b===_.Oo||b===
_.So)&&a.Gc&&a.Gc.stop();b===_.Mo?a.trigger(new _.L(_.jd,{detail:{bufferedTimeMS:-1,reason:f}})):e===_.Mo&&a.trigger(new _.L(_.id,{detail:{bufferedTimeMS:d,reason:f}}))}}};
VD=function(a){var b=!1;b=void 0===b?!0:b;var c,d;return _.E(function(e){switch(e.a){case 1:return a.G===QD?e["return"](Promise.reject(new _.P(_.Q,7,7E3))):_.x(e,RD(a),2);case 2:return _.x(e,SD(a),3);case 3:c=_.Dj(4)||_.Dj(5);if(!b&&!c){e.F(0);break}d=a.getSurface().getMedia();return _.x(e,TD(a,d),5);case 5:return _.x(e,UD(a,d),0)}})};
bE=function(a,b,c){c=void 0===c?!0:c;var d,e,f,g,h,l,m,n;return _.E(function(p){switch(p.a){case 1:if(a.G===QD)return p["return"](Promise.reject(new _.P(_.Q,7,7E3)));d=new _.wj;e=function(){return a.Yb!==d};f=function(){a.log.info("Aborting current load");throw new _.P(_.Q,7,7E3);};a.Yb=d;_.A(p,2);e()&&f();if(!a.ha){p.F(4);break}_.A(p,5);return _.x(p,a.ha,7);case 7:_.ah(p,6,2);break;case 5:_.C(p,2);case 6:e()&&f();case 4:return a.J=new _.Co,a.Df=Date.now()/1E3,PD(a,_.To),a.w=_.Zo(b),_.Cl(b)&&(a.configuration=
_.Bl(a.fe,b)),a.log.info(_.vb,a.configuration),a.log.info(_.Ib,a.w),(g=a.getTrackManager())&&g.load(),h=a.getSurface().getMedia(),h.loop=!!a.configuration.loop,_.N.R(a.configuration.volume)||a.setVolume(a.configuration.volume),_.N.R(a.configuration.muted)||a.setMuted(a.configuration.muted),WD(a),a.I&&(a.I.release(),a.I=null),a.I=new _.Xs(a.getNetworkEngine()),Az(a.I,{enabled:a.configuration.abr.useCmsd}),l=a.w[a.getSourceIndex()],e()&&f(),_.x(p,TD(a,h),8);case 8:return e()&&f(),_.x(p,UD(a,h),9);case 9:return e()&&
f(),_.x(p,XD(a,l),10);case 10:return _.rn(hz),e()&&f(),_.x(p,YD(a,l),11);case 11:return _.rn(gz),_.sn("Fetch and parse manifest",hz,gz),e()&&f(),_.x(p,ZD(a),12);case 12:_.rn("initDrm.end");_.sn("Init DRM",gz,"initDrm.end");if(!c){p.F(13);break}e()&&f();return _.x(p,$D(a),14);case 14:return e()&&f(),_.x(p,aE(a),13);case 13:e()&&f();d.resolve();_.ah(p,0);break;case 2:throw n=m=_.C(p),e()&&(n=new _.P(_.Q,7,7E3)),d.reject(n),a.onError(n),n;}})};
TD=function(a,b){a.j||(a.o.on(b,_.ne,function(){if(a.j.error){var c=a.j.error.code;if(1==c)c=null;else{var d=a.j.error.msExtendedCode;d&&(0>d&&(d+=Math.pow(2,32)),d=d.toString(16));c=new _.P(_.Q,3,3016,{code:c,extendedError:d,message:a.j.error.message})}}else c=null;if(c)a.onError(c)}),a.j=b);return Promise.resolve()};SD=function(a){a.j&&(a.o.off(a.j,_.ne),a.j=null);return Promise.resolve()};
RD=function(a){var b;return _.E(function(c){switch(c.a){case 1:a.G!==QD&&(a.G=LD);if(b=a.j)a.o.off(b,_.Ee),a.o.off(b,_.of),a.o.off(b,_.cf),a.o.off(b,_.me),a.o.off(b,_.Ef),a.o.off(b,_.Cf);a.Kc&&(a.Kc.release(),a.Kc=null);a.Gc&&(a.Gc.stop(),a.Gc=null);if(!a.B){c.F(2);break}return _.x(c,a.B.stop(),3);case 3:a.B=null;case 2:if(!a.h){c.F(4);break}return _.x(c,a.h.stop(),4);case 4:if(!a.a){c.F(6);break}return _.x(c,a.a.destroy(),7);case 7:a.a=null;case 6:a.A&&(a.A.release(),a.A=null);if(!a.M){c.F(8);break}return _.x(c,
a.M.destroy(),9);case 9:a.M=null;case 8:a.oe&&(a.oe.release(),a.oe=null);b&&b.src&&(b.removeAttribute("src"),b.load());if(!a.l){c.F(10);break}return _.x(c,a.l.destroy(),11);case 11:a.l=null;case 10:a.I&&(a.I.release(),a.I=null),a.V.clear(),a.H=null,a.qe.clear(),a.f=null,a.J=null,a.ea=!0,a.Cc.clear(),a.sd=!1,cE(a),_.y(c)}})};
UD=function(a,b){var c,d,e;return _.E(function(f){if(1==f.a)return c=window.muxjs?new JA:new _.KA,d=_.vo(a.configuration,[_.te,"single-native"]),a.P=d.create(a),a.wd=OD(a),a.wd.track(a),e=new _.MA(b,c,a.P,a.wd,a.configuration),_.x(f,e.I,2);a.M=e;_.y(f)})};XD=function(a,b){var c,d;return _.E(function(e){if(1==e.a)return c=a.getNetworkEngine(),d=a,_.x(e,_.Cs(b.url,c,a.configuration.manifest.attemptParameters,b.type||null),2);d.B=e.f;a.B.configure(a.configuration.manifest);_.y(e)})};
YD=function(a,b){var c;return _.E(function(d){a.gc=new qA;rA(a.gc,function(e){dE(a,_.Ph,e)});c=new _.xj(Promise.resolve().then(function(){var e,f,g;return _.E(function(h){switch(h.a){case 1:if(a.f){h.F(3);break}_.A(h,4);e=a;return _.x(h,a.B.start(b.url,eE(a)),6);case 6:e.f=h.f;_.ah(h,1);break;case 4:f=_.C(h);if(!a.Hc)throw f;return _.x(h,a.Hc(b.url,f),8);case 8:if(g=h.f)b.url=g;else throw f;h.F(1);break;case 3:if(0==a.f.periods.length)throw new _.P(_.Q,4,4014);fE(a.f.periods);_.y(h)}})}),function(){a.log.info("Aborting parser step...");
return a.B.stop()});return _.x(d,c.O,0)})};
ZD=function(a){var b,c,d,e,f;return _.E(function(g){switch(g.a){case 1:a.l=new _.xn({Gb:a.getNetworkEngine(),onError:function(h){return a.onError(h)},yf:function(h){if(a.a){var l=gE(a),m=!1,n=Object.keys(h);0===n.length&&a.log.warn("Got a key status event without any key statuses, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");var p=1===n.length&&"00"===n[0];p&&a.log.warn("Got a synthetic key status event, so we don't know the real key statuses. If we don't have all the keys, you'll need to set restrictions so we don't select those tracks.");if(n.length){n=
a.getPeriods();for(var q=0;q<n.length;q++)for(var t=n[q],v=_.u(t.variants),z=v.next();!z.done;z=v.next()){z=z.value;var D=[];z.audio&&D.push(z.audio);z.video&&D.push(z.video);D=_.u(D);for(var G=D.next();!G.done;G=D.next()){G=G.value;var F=z.allowedByKeySystem;if(G.keyId){var B=h[p?"00":G.keyId];B=!!B&&!hE.includes(B);z.allowedByKeySystem=B}F!==z.allowedByKeySystem&&(B=G.type,G.type===_.sg&&(B="video "+G.width+"x"+G.height+"@"+_.R.Re(G.bandwidth)),a.log.warn("DRM Key not available for KID: '"+(G.keyId+
"'. Applying restrictions to "+B)));t===l&&F!==z.allowedByKeySystem&&(m=!0)}}}if(h=RC(a.a))if(p=TC(a.a),n=UC(a.a),p=vB(p,n,h.variants),!p||p.allowedByKeySystem)a.log.info(Py),iE(a),jE(a,h.variants);m&&h!==l&&(a.log.info(Py),iE(a),jE(a,l.variants))}},onExpirationUpdated:function(h,l){if(a.B&&a.B.onExpirationUpdated)a.B.onExpirationUpdated(h,l);a.trigger(new _.L(_.ee,{expirationTime:l}))},onEvent:function(h){return a.Ye(h)},getConfiguration:function(){return a.getConfiguration()},Sc:function(){return a.Sc()}});
kE(a);c=(b=a.configuration.drm)?b.offlineId||"":"";d=[];e=_.vs(a.f.periods);if(!c){g.F(2);break}f=_.Fl(_.df);if(!f){g.F(2);break}return _.x(g,f.l(a,e),4);case 4:return _.x(g,f.j(c),5);case 5:d=g.f;case 2:return _.x(g,_.Hn(a.l,e,d),6);case 6:a.f&&lE(a,a.f.periods),_.y(g)}})};
$D=function(a){var b,c,d,e;return _.E(function(f){if(1==f.a)return b=a.j,c=function(g){a.j&&a.H&&(g.type===_.Mf&&a.se?(a.H.a=fC,cE(a)):g.type===_.Ag&&a.getState()===_.Vo&&.1>a.getBufferInfo().Na(a.getPosition())?(a.H.a=fC,cE(a)):a.H&&mE(a));nE(a)},d=function(){if(a.j){var g=a.j.playbackRate;0!=g&&a.K.set(g)}},a.o.on(b,_.of,c),a.o.on(b,_.cf,c),a.o.on(b,_.me,c),a.o.on(b,_.Mf,c),a.o.on(b,_.Lf,c),a.o.on(b,_.Cf,c),a.o.on(b,_.Ag,c),a.o.on(b,_.Ef,d),a.h||(a.h=new _.RB,a.h.configure(a.configuration.abr)),
null!==a.I&&a.h.setCmsdManager(a.I),oE(a,a.f.periods),a.Ic=new $B(a.configuration.preferredAudioLanguage||[],a.configuration.preferredAudioRole,a.configuration.preferredAudioChannelCount,a.configuration.preferSpatialAudio),a.md=a.configuration.preferredTextLanguage,a.ne=a.configuration.preferredTextRole,a.ld=a.configuration.preferForcedSubtitles,_.x(f,_.Un(a.l,b),2);if(!a.l)throw new _.P(_.Q,7,7001);a.h.init(function(g,h,l){!a.ea&&pE(a,g,h,l)});a.A=qE(a,a.configuration.startTime);a.Kc=rE(a);a.K=new lC({Qg:function(){return b.playbackRate},
mm:function(g){b.playbackRate=g},Pk:function(g){b.currentTime+=g}});mC(a.K,a.configuration.trickPlay);a.isLive()&&a.configuration.streaming.enableLiveEdgeChasing&&(a.oe=new iC(a));e=Math.max(1E-4,a.configuration.streaming.rebufferingGoal);sE(a,e);kB(a.f,_.Th(a.configuration.preferredVideoCodec),_.Th(a.configuration.preferredAudioCodec),a.configuration.preferredAudioChannelCount);a.a=tE(a);a.a.h=a.configuration.streaming;a.G=MD;_.y(f)})};
aE=function(a){var b,c,d,e,f,g,h;return _.E(function(l){if(1==l.a)return _.x(l,a.a.start(),2);if(!a.a)throw new _.P(_.Q,7,7001);a.configuration.streaming.startAtSegmentBoundary&&(b=JC(a.A),c=uE(a,b),CC(a.A.f,c));d=_.u(a.f.periods);for(e=d.next();!e.done;e=d.next())f=e.value,vE(a,f);iE(a);g=gE(a)||a.f.periods[0];h=g.variants.some(function(m){return m.primary});a.configuration.preferredAudioLanguage||h||a.log.warn("No preferred audio language set.  We will choose an arbitrary language initially");jE(a,
g.variants);a.o.one(a.j,_.Ee,function(){a.J.A=Date.now()/1E3-(null===a.Df?0:a.Df)});_.y(l)})};fE=function(a){function b(d){return d.video&&d.audio||d.video&&d.video.codecs.includes(",")}if(a.some(function(d){return d.variants.some(b)})){_.th("Found variant with audio and video content, so filtering out audio-only content in all periods.");a=_.u(a);for(var c=a.next();!c.done;c=a.next())c=c.value,c.variants=c.variants.filter(b)}};
qE=function(a,b){return new HC(a.j,a.f,a.configuration.streaming,b,function(){a.Kc&&yA(a.Kc,!0);a.a&&fD(a.a)},function(c){return a.dispatchEvent(c)})};rE=function(a){var b=new jC(a.f);kC(b,function(){iE(a)});var c=new AA(a.gc);BA(c,function(e){e.we&&e.we();dE(a,_.Rh,e)},function(e){e.xf&&e.xf();dE(a,_.Sh,e)},function(e,f){f||(e.we&&e.we(),dE(a,_.Rh,e),e.xf&&e.xf(),dE(a,_.Sh,e))});var d=new zA(a.j);d.a.add(b);d.a.add(c);return d};
sE=function(a,b){a.H=new gC(b,Math.min(.5,b/2));a.H.a=fC;cE(a);a.Gc=(new _.uk(function(){mE(a)})).jb(.25)};
mE=function(a){switch(a.G){case MD:a:if(a.j.ended||SA(a.M))var b=!0;else{if(a.isLive()){b=lA(a.f.presentationTimeline);var c=a.getBufferInfo();if(null!==c&&(c=c.Fa(),null!==c&&c>=b)){b=!0;break a}}b=!1}break;default:b=!1}if(a.M){var d=UA(a.M);c=d.video;d=d.audio;var e=a.j.currentTime;c&&d?(c=c.Na(e),d=d.Na(e),c=Math.min(c,d)):c=c?c.Na(e):d?d.Na(e):0}else c=0;if(d=a.H){d=a.H;var f=b,g=d.f.get(d.a);e=d.a;c=f||c>=g?eC:fC;d.a=c;d=e!=c}c=d;d=wE(a);c||a.getState()===_.Mo&&!d?(a.log.debug("Buffering state changed. Is buffering",
d,"buffered to end",b,"state",a.getState()),cE(a)):a.sd&&nE(a)};tE=function(a){var b={Cb:function(){return JC(a.A)},X:a.M,Gb:a.getNetworkEngine(),wf:a.dj.bind(a),vf:a.cj.bind(a),onError:a.onError.bind(a),nh:a.ll.bind(a),onEvent:a.Ye.bind(a),rh:a.ej.bind(a),xe:a.yl.bind(a),ef:function(){return a.h},Se:a.li.bind(a),Nh:a.tm.bind(a),vd:a.l};return new _.PC(a.f,b)};kE=function(a){var b=_.Xl(a.configuration.drm);a.l.h=b};
WD=function(a){a.B&&a.B.configure(a.configuration.manifest);a.l&&kE(a);if(a.a){a.a.h=a.configuration.streaming;try{for(var b=_.u(a.f.periods),c=b.next();!c.done;c=b.next())vE(a,c.value)}catch(e){a.onError(e)}c=TC(a.a);var d=UC(a.a);b=gE(a)||a.f.periods[0];c=vB(c,d,b.variants);a.h&&c&&c.allowedByApplication&&c.allowedByKeySystem?jE(a,b.variants):(a.log.debug("Choosing new streams after changing configuration"),xE(a,b))}a.h&&(a.h.configure(a.configuration.abr),a.configuration.abr.enabled&&!a.ea?a.h.enable():
a.h.disable());a.K&&a.configuration.trickPlay&&mC(a.K,a.configuration.trickPlay)};KB=function(a){if(a.f&&a.A){var b=yE(a),c=[];a=_.u(zE(a));for(var d=a.next();!d.done;d=a.next()){d=d.value;var e=qB(d);e.active=d==b;c.push(e)}return c}return[]};IB=function(a,b){if(a.f&&a.a){var c=gE(a),d=c.textStreams.find(function(e){return e.id==b.id});d?(AE(a,c,d,!1),BE(a,d),a.md=d.language,a.ld=d.kind===_.oe):a.log.error(_.Ty,b.id)}};
LB=function(a,b,c){var d=void 0===d?0:d;if(a.f&&a.a){var e=gE(a);if(a.configuration.abr.enabled&&b)a.log.info("Disable ABR and enable manual track selection to select "+(b.width+"x"+b.height+"@"+b.bandwidth)),a.configuration.abr.enabled=!1,a.h.disable();else if(!a.configuration.abr.enabled&&!b){a.log.info("Enable ABR Selection");a.configuration.abr.enabled=!0;a.h.enable();a.da=null;c=jE(a,e.variants);null!=a.Ma&&(a.Ic=a.Ma,a.Ma=null);null==c||a.ea||pE(a,c);return}if(b){a.da=b.id;var f=e.variants.find(function(g){return g.id==
b.id});f?(a.da=f.video.id,sB(f)?(CE(a,e,f,!1),DE(a,f,c,d),null==a.Ma&&(a.Ma=a.Ic),a.Ic=new aC(f),jE(a,e.variants)):a.log.error("Unable to switch to restricted track",b.id)):a.log.error("No variant with id",b.id)}else a.da=null,null!=a.Ma&&(a.Ic=a.Ma,a.Ma=null),c=jE(a,e.variants),null==c||a.ea||pE(a,c)}};
JB=function(a,b){if(a.configuration.streaming.disableAudioTracks)Promise.reject(Error("Audio tracks are disabled by config."));else{if(a.a&&(a.f||a.A)){var c=UC(a.a),d=TC(a.a),e=Xz(a.f.periods,JC(a.A)),f=a.f.periods[e?a.f.periods.indexOf(e):0].variants.filter(function(m){return m.audio.id===b&&sB(m)});e=!1;var g=void 0;if(c){if(g=f.find(function(m){return m.video.id===c.id}),!g){a.log.debug("Cannot find exact variant, looking for anything else that matches with given audioId");e=!0;var h=a.getTrackManager().Ia();
if(h){var l=h.renditions.map(function(m){return m.id});g=f.find(function(m){return l.find(function(n){return n===String(m.video.id)})})}}}else g=f[0];if(g){if(d.codecs.split(".")[0]===g.audio.codecs.split(".")[0]){d=g.audio;a.Jc=d.id;a.h.setVariants(f);f=gE(a);CE(a,f,g,!1);e||a.ea?DE(a,g,!0,0):_.cD(a.a,d,!0,0);Promise.resolve();return}a.log.warn("Target audio codecs not compatible with active audio codecs.")}}Promise.reject()}};
MB=function(a){var b=a.tf;return a.f?a.M.getTextDisplayer().isTextVisible():b};HB=function(a,b){var c,d,e,f;return _.E(function(g){c=a.tf;d=b;if(c==d)return g["return"]();a.tf=d;if(a.G!==MD)return g.F(0);a.M.getTextDisplayer().setTextVisibility(b);if(a.configuration.streaming.alwaysStreamText)return g.F(0);if(!b)return bD(a.a),g.F(0);e=gE(a);f=_.uB(e.textStreams,a.md,a.ne,a.ld);return 0<f.length?_.x(g,ZC(a.a,f[0]),0):g.F(0)})};
CE=function(a,b,c,d){var e=a.getTrackManager();a.B.setCurrentVariant(c);if(e){var f=a.J.B;if(c.video){PB(e,c.video,d);var g=e.ka();f.j!==g&&(f.j=g,f.a.push({timestamp:Date.now()/1E3,id:g.id,trackId:g.track.id,type:g.track.type,fromAdaptation:d,width:g.width,height:g.height,bandwidth:g.bandwidth}))}c.audio&&(PB(e,c.audio,d),e=e.Qa(),f.f!==e&&(f.f=e,f.a.push({timestamp:Date.now()/1E3,id:e.id,trackId:e.track.id,type:e.track.type,fromAdaptation:d,width:null,height:null,bandwidth:e.bandwidth})))}VB(a.V,
b).variant=c};AE=function(a,b,c,d){VB(a.V,b).text=c;if(b=a.getTrackManager())PB(b,c,d),c=b.Ha(),a=a.J.B,a.h!==c&&(a.h=c,a.a.push({timestamp:Date.now()/1E3,id:c.id,trackId:c.track.id,type:c.track.type,fromAdaptation:d,width:null,height:null,bandwidth:null}))};
oE=function(a,b){for(var c=0;c<b.length;c++){for(var d=b[c],e=new Map,f=_.u(d.variants),g=f.next();!g.done;g=f.next())if(g=g.value,g.video&&g.video.closedCaptions){g=g.video;for(var h=_.u(g.closedCaptions.keys()),l=h.next();!l.done;l=h.next())if(l=l.value,!e.has(l)){var m={id:a.Uh++,originalId:l,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,ya:0,mimeType:_.Sc,codecs:"",kind:_.md,encrypted:!1,
keyId:null,language:g.closedCaptions.get(l),label:null,type:_.bg,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:g.roles,channelsCount:null,spatialAudio:!1,closedCaptions:null};e.set(l,m)}}e=_.u(e.values());for(f=e.next();!f.done;f=e.next())d.textStreams.push(f.value)}};
lE=function(a,b){for(var c=a.a?TC(a.a):null,d=a.a?UC(a.a):null,e=_.u(b),f=e.next();!f.done;f=e.next())pB(a.l,c,d,f.value);c=Hz(b,function(h){return h.variants.some(sB)});if(a.configuration.streaming.disableAudioTracks)for(d=_.u(b),e=d.next();!e.done;e=d.next())for(f=_.u(e.value.variants),e=f.next();!e.done;e=f.next())delete e.value.audio;if(a.configuration.streaming.disableVideoTracks)for(d=_.u(b),e=d.next();!e.done;e=d.next())for(f=_.u(e.value.variants),e=f.next();!e.done;e=f.next()){e=e.value;var g=
e.video;!g||1<Nz(g.type,_.rk(g.mimeType,g.codecs)).size||delete e.video}if(0===c)throw new _.P(_.Q,4,4032);if(c<b.length)throw new _.P(_.Q,4,4011);c=_.u(b);for(e=c.next();!e.done;e=c.next())d=e.value,mB(d.variants,a.configuration.restrictions,a.Sh)&&a.a&&gE(a)==d&&iE(a),EE(a,d.variants)};
vE=function(a,b){var c=a.a?TC(a.a):null,d=a.a?UC(a.a):null;pB(a.l,c,d,b);d=b.variants;if(!d.some(sB))throw new _.P(_.Q,4,4011);EE(a,b.variants);mB(d,a.configuration.restrictions,a.Sh)&&a.a&&gE(a)==b&&iE(a);if(!_.Dj(2)&&(c=a.l?a.l.getDrmInfo():null)){d=_.u(d);for(var e=d.next();!e.done;e=d.next()){e=_.u(e.value.drmInfos);for(var f=e.next();!f.done;f=e.next())if(f=f.value,f.keySystem===c.keySystem){f=_.u(f.initData||[]);for(var g=f.next();!g.done;g=f.next())g=g.value,_.Xn(a.l,g.keyId,g.initData)||_.On(a.l,
g.initDataType,g.initData,g.keyId)}}}};DE=function(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?0:d;a.ea?(a.Da=b,a.Oh=c,a.Kh=d):dD(a.a,b,c,d)};BE=function(a,b){a.ea?a.pa=b:_.cD(a.a,b,!0,0)};FE=function(a){if(a.a&&a.f){var b=RC(a.a),c=gE(a);null!=b&&b==c&&(TC(a.a),UC(a.a),_.SC(a.a,_.bg),VB(a.V,c),VB(a.V,c))}};
uE=function(a,b){function c(g,h){if(!g)return null;var l=g.findSegmentPosition(h-f.startTime);return null==l?null:(l=g.getSegmentReference(l))?l.startTime+f.startTime:null}var d=TC(a.a),e=UC(a.a),f=gE(a);d=c(d,b);e=c(e,b);return null!=e&&null!=d?Math.max(e,d):null!=e?e:null!=d?d:b};wE=function(a){return a.l&&a.l.C?!0:a.H?a.H.getState()===fC:!1};cE=function(a){if(a.J&&a.H&&a.A){var b=GE(a)===_.Mo,c=a.K;c.l=b;pC(c,c.o?"seek":void 0);a.A.j.o=b;nE(a)}};nE=function(a){PD(a,GE(a))};
GE=function(a){var b=a.getDuration(),c=a.getPosition();return a.j&&a.j.ended||(a.sd||a.qa===_.Oo)&&1>=Math.abs(b-c)?_.Oo:wE(a)||a.se?_.Mo:a.j&&a.j.paused?_.Uo:_.Vo};
jE=function(a,b){try{EE(a,b)}catch(e){return a.onError(e),null}var c=b.filter(function(e){return sB(e)});c=zB(c,a.Jc);var d=a.Ic.create(c);d=Array.from(d.values());a.h.setVariants(d);if(null!==a.da&&null!==a.Jc&&(d=d.find(function(e){return e.video.id==a.da&&e.audio.id==a.Jc}),a.da=null,d))return d;if(a.configuration.abr.enabled||null===a.da)return a.h.chooseVariant();c=c.find(function(e){return null!==e.video&&e.video.id===a.da});return c?c:(a.log.warn("Selected video track not found. Falling back to ABR selection"),
a.h.chooseVariant())};HE=function(a,b){return _.uB(b,a.md,a.ne,a.ld)[0]||null};xE=function(a,b,c){c=void 0===c?!0:c;var d=jE(a,b.variants);a.Jc=d&&d.audio&&d.audio.id;d&&(CE(a,b,d,!0),DE(a,d,c));(c=HE(a,b.textStreams))&&(a.configuration.streaming.alwaysStreamText||MB(a))&&(AE(a,b,c,!0),BE(a,c))};
KE=function(a,b){a.ea=!0;a.h.disable();a.log.debug("Choosing new streams after period changed");var c=jE(a,b.variants),d=HE(a,b.textStreams);a.Da&&(b.variants.includes(a.Da)&&(c=a.Da),a.Da=null);a.pa&&(b.textStreams.includes(a.pa)&&(d=a.pa),a.pa=null);c&&IE(a,b,function(){return CE(a,b,c,!0)});d&&(a.configuration.streaming.alwaysStreamText||MB(a))&&IE(a,b,function(){return AE(a,b,d,!0)});b===gE(a)&&JE(a);return a.configuration.streaming.alwaysStreamText||MB(a)?{variant:c,text:d}:{variant:c,text:null}};
pE=function(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?0:d;if(a.configuration.abr.enabled){a.log.debug("switch_");var e=LE(a,b);IE(a,e,function(){return CE(a,e,b,!0)});e===gE(a)&&JE(a);a.a&&dD(a.a,b,c,d)}};iE=function(a){var b=a.getTrackManager();b&&a.G!==QD&&(b.m&&(OB(b),b.m.trigger(new _.L(_.cu))),JE(a))};JE=function(a){var b=gE(a);if(b){var c=a.Cc.get(b)||[];for(a.Cc["delete"](b);c.length;)c.shift()()}};IE=function(a,b,c){a.Cc.has(b)||a.Cc.set(b,[]);a.Cc.get(b).push(c)};
dE=function(a,b,c){a.trigger(new _.L(b,{detail:pA(c)}))};
EE=function(a,b){var c=a.l?_.N.Zf(a.l.pa):{},d=Object.keys(c);d=d.length&&"00"==d[0];for(var e=!1,f=!1,g=[],h=[],l=_.u(b),m=l.next();!m.done;m=l.next()){m=m.value;var n=[];m.audio&&n.push(m.audio);m.video&&n.push(m.video);n=_.u(n);for(var p=n.next();!p.done;p=n.next())if(p=p.value,p.keyId){var q=c[d?"00":p.keyId];q?hE.includes(q)&&(h.includes(q)||h.push(q)):g.includes(p.keyId)||g.push(p.keyId)}m.allowedByApplication?m.allowedByKeySystem&&(e=!0):f=!0}if(!e)throw new _.P(_.Q,4,4012,{hasAppRestrictions:f,
missingKeys:g,restrictedKeyStatuses:h});};zE=function(a){var b=gE(a);if(null==b)return[];FE(a);return b.variants.filter(function(c){return sB(c)})};ME=function(a){var b=gE(a);if(null==b)return[];FE(a);return b.textStreams.filter(function(c){return!a.qe.has(c)})};gE=function(a){var b=JC(a.A),c=null;a=_.u(a.f.periods);for(var d=a.next();!d.done;d=a.next())d=d.value,d.startTime<=b&&(c=d);return c};yE=function(a){var b=gE(a);return b&&VB(a.V,b).variant};
LE=function(a,b){for(var c=_.u(a.f.periods),d=c.next();!d.done;d=c.next())if(d=d.value,d.variants.includes(b))return d;return null};
NE=function(a,b,c){var d,e,f,g,h,l,m,n,p,q,t,v,z,D,G,F,B,I,O;return _.E(function(M){switch(M.a){case 1:return d=_.fp,_.A(M,2),_.x(M,_.Cs(b.url,a.getNetworkEngine(),a.configuration.manifest.attemptParameters,b.type||null),4);case 4:return e=M.f,e.configure(a.configuration.manifest),_.x(M,e.start(b.url,eE(a)),5);case 5:f=M.f;fE(f.periods);if(!f.periods.length)throw new _.P(_.Q,4,4014);return _.x(M,a.B.stop(),6);case 6:a.B=e;g=c.audio&&c.audio.id;h=c.video&&c.video.id;a.f.periods=f.periods;l=Xz(f.periods,
JC(a.A))||f.periods[0];kB(a.f,_.Th(a.configuration.preferredVideoCodec),_.Th(a.configuration.preferredAudioCodec),a.configuration.preferredAudioChannelCount);m=AB(g,h,l.variants);n=HE(a,l.textStreams);jE(a,l.variants);p=m&&m.video;q=m&&m.audio;t=[];v=new Set;z=_.u(l.variants);for(D=z.next();!D.done;D=z.next())G=D.value,G.video&&v.add(G.video),G.audio&&v.add(G.audio);F=_.u(_.Og(v).concat(_.Og(l.textStreams)));for(B=F.next();!B.done;B=F.next())I=B.value,t.push(I.createSegmentIndex());return _.x(M,Promise.all(t),
7);case 7:lD(a.a,d.AUDIO,q);lD(a.a,d.VIDEO,p);lD(a.a,d.TEXT,n);m&&CE(a,l,m,!1);a.log.info("Switch CDN successful.");_.ah(M,0);break;case 2:O=_.C(M);if(!e){M.F(8);break}return _.x(M,e.stop(),8);case 8:throw O;}})};
eE=function(a){return{networkingEngine:a.getNetworkEngine(),filterNewPeriod:function(b){return vE(a,b)},filterAllPeriods:function(b){return lE(a,b)},onTimelineCueAdded:function(b){var c=a.gc;a:{var d=_.u(c.a);for(var e=d.next();!e.done;e=d.next())if(e=e.value,e.schemeIdUri===b.schemeIdUri&&e.startTime===b.startTime&&e.endTime===b.endTime){d=e;break a}d=null}null==d&&(c.a.add(b),c.f(b))},onEvent:function(b){return a.Ye(b)},onError:function(b){return a.onError(b)}}};OE=function(){};
PE=function(){var a=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(b){for(var c=[],d=0;d<arguments.length;++d)c[d]=arguments[d];c=a.apply(this,c);c.abort=function(){};return c}};QE=function(){var a=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(b,c){return a.call(this,b,c-.001)}};RE=function(){var a=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(b){return"mp2t"==b.split(/ *; */)[0].split("/")[1].toLowerCase()?!1:a(b)}};
SE=function(){var a=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(b){return"opus"!=_.Pz(b)[0]&&a(b)}};
TE=function(){var a=MediaSource.isTypeSupported,b=/^dv(?:h[e1]|a[v1])\./;MediaSource.isTypeSupported=function(c){var d=c.split(/ *; */),e=d.shift(),f={};d=_.u(d);for(var g=d.next();!g.done;g=d.next())g=g.value.split("\x3d"),f[g[0]]=g[1].replace(/"(.*)"/,"$1");d=f.codecs;if(!d)return a(c);var h=!1,l=!1;c=d.split(",").filter(function(n){b.test(n)&&(l=!0);/^(hev|hvc)1\.2/.test(n)&&(h=!0);return!0});l&&(h=!1);f.codecs=c.join(",");h&&(f.eotf="smpte2084");for(var m in f)e+="; "+m+'\x3d"'+f[m]+'"';return cast.__platform__.canDisplayType(e)}};
UE=function(a){_.pt.call(this,a);a=a.getSurface().getMedia();this.a=null;for(var b=0;b<a.textTracks.length;++b){var c=a.textTracks[b];c.mode=_.Xd;c.label===Vy&&(this.a=c)}this.a||(this.a=a.addTextTrack(_.oz,Vy));this.a.mode=_.se};VE=function(a,b){var c=a.mode;a.mode=c==_.Nf?_.Nf:_.se;for(var d=a.cues,e=d.length-1;0<=e;e--){var f=d[e];f&&b(f)&&a.removeCue(f)}a.mode=c};WE=function(){};_.Li.prototype.f=qz(0,function(){return this.keyInfo});var sz=[112,115,115,104,0,0,0,0];_.Dz.prototype.f=function(){return this.keyInfo};
_.YE=function XE(a){var c,d,e,f,g,h;return _.ih(XE,function(l){1==l.a&&(c=-1,e=d=void 0,f=_.u(a),g=f.next());if(5!=l.a){if(g.done)return-1===c?l.F(0):_.x(l,{Vg:c,Yl:d,item:e,next:void 0},0);h=g.value;return 0<=c?_.x(l,{Vg:c,item:e,Yl:d,next:h},5):l.F(5)}c++;d=e;e=h;g=f.next();return l.F(2)})};Jz.prototype.destroy=function(){this.a&&(this.a.dispose(),this.a=null);return Promise.resolve()};
Jz.prototype.A=function(a){this.h=a.captions;var b=new Uint8Array(a.data.byteLength+a.initSegment.byteLength);b.set(a.initSegment,0);b.set(a.data,a.initSegment.byteLength);a.type===_.sg?this.o.push(b):a.type===_.$c&&this.l.push(b)};Jz.prototype.w=function(){var a={video:_.jj.apply(_.cj,_.Og(this.o)),captions:this.h,audio:_.jj.apply(_.cj,_.Og(this.l))};this.f.resolve(a);this.j=!1};
_.Sz.prototype.track=function(a){null!=this.player&&(this.player&&(this.player.off(_.Jf,this.a),this.f&&this.player.off(_.eg,this.a)),this.player=null);a&&(this.player=a,this.player.on(_.Jf,this.a,this))};
_.Sz.prototype.append=function(a,b,c){var d=this.j?this.j(c):null;d||this.log.debug("Unable to resolve rendition for id",c);c={start:a,end:b,rendition:d,width:d?d.width:0,height:d?d.height:0,bandwidth:d?d.bandwidth:0};var e=this.S.find(function(f){return f.start>=a&&f.end<=b});if(e)e.rendition=d,e.width=c.width,e.height=c.height,e.bandwidth=c.bandwidth,e.start=c.start,e.end=c.end;else{d=_.u(this.S);for(e=d.next();!e.done;e=d.next())e=e.value,a>=e.start&&a<e.end?e.end=a:b>=e.start&&b<e.end&&(e.start=
b);this.S.push(c);this.S.sort(Rz)}Vz(this);this.a();this.player&&this.player.trigger(new _.L(_.vg))};_.Sz.prototype.clear=function(){this.S=[];Vz(this);this.player&&(this.player.trigger(new _.L(_.vg)),this.player.trigger(new _.L(_.ed)))};
_.Sz.prototype.a=function(){if(this.player){var a=this.player.getPosition();if(0<=a){a:{for(var b=this.S.length,c=Number.MAX_SAFE_INTEGER,d=0;d<b;d++){var e=this.S[d];c=Math.min(e.start,c);if(e.start<=a&&e.end>a){a=.1>e.end-a&&d<b-1?this.S[d+1].rendition:e.rendition;break a}if(e.start>a)break}a=0<b&&c>a&&.25>c-a?this.S[0].rendition:null}if(a&&this.h!==a&&(this.h=a,this.player)){c=b=-1;if(a)b=a.width||-1,c=a.height||-1;else if(d=this.player.getSurface().getMedia())b=d.videoWidth,c=d.videoHeight;this.player.trigger(new _.L(_.gd,
{detail:{width:b,height:c,bandwidth:a?a.bandwidth:null,rendition:a}}))}}}};_.r=_.fA.prototype;_.r.Tc=function(){return this.H};_.r.getDuration=function(){return this.f};_.r.getPresentationStartTime=function(){return this.A};_.r.offset=function(a){null!=this.o&&(this.o+=a);null!=this.h&&(this.h+=a)};_.r.isLive=function(){return Infinity==this.f&&!this.j};qA.prototype.release=function(){this.f=function(){};this.a.clear()};qA.prototype.cues=function(){return this.a};
sA.prototype.next=function(){var a=this.h.get(this.a);a&&0<a.a.length?(this.f+=1,a.Sa().length&&this.f===a.a.length&&(this.a+=1,this.f=0)):(this.a+=1,this.f=0);a=tA(this);return{value:a,done:!a}};_.r=_.uA.prototype;_.r.destroy=function(){this.a=[];return Promise.resolve()};
_.r.Mc=function(a){for(var b=this.a.length-1;0<=b;--b){var c=this.a[b];if(a>=c.startTime&&a<c.endTime)return c.position}if(this.a.length&&a<this.a[0].startTime)return this.a[0].position;this.g.warn("No Segment found for "+a+". We have "+this.a.length+" references");for(a=0;a<this.a.length;a++)b=this.a[a],this.g.debug("SegmentIndex Ref "+a+" start: "+b.startTime+" end: "+b.endTime+" pos: "+b.position);return null};
_.r.get=function(a){if(0==this.a.length)return null;a-=this.a[0].position;return 0>a||a>=this.a.length?null:this.a[a]};_.r.offset=function(a){this.g.info("Apply offset"+a+" to segment index");for(var b=_.u(this.a),c=b.next();!c.done;c=b.next())c=c.value,c.startTime+=a,c.endTime+=a,c.ya-=a};
_.r.jd=function(a,b){var c=a-this.a[0].position;if(0<=c&&c<this.a.length)for(this.g.warn("Accounting for segment duration drift",b,"at",c),this.a[c].endTime+=b,c+=1;c<this.a.length;++c)this.a[c].startTime+=b,this.a[c].endTime+=b};_.r.getDuration=function(){return this.a[this.a.length-1].endTime-this.a[0].startTime};
_.r.oa=function(a){for(var b=[],c=[],d=0,e=0;d<this.a.length&&e<a.length;){var f=this.a[d],g=a[e];f.startTime<g.startTime?(b.push(f),d++):(f.startTime>g.startTime?0===d?c.push(g):this.g.info("Refusing to rewrite original references on update!"):(.1<Math.abs(f.endTime-g.endTime)?(f=new _.Li(f.position,g.startTime,g.endTime,g.Sa,g.wa,g.ia,g.ya,g.keyInfo,g.Oc,g.timescale,g.horizontalTiles,g.verticalTiles,g.durationPerTile),b.push(f)):b.push(f),d++),e++)}for(;d<this.a.length;)b.push(this.a[d++]);if(b.length)for(d=
b[b.length-1].position+1;e<a.length;)f=a[e++],f=new _.Li(d++,f.startTime,f.endTime,f.Sa,f.wa,f.ia,f.ya,f.keyInfo,f.Oc,f.timescale,f.horizontalTiles,f.verticalTiles,f.durationPerTile),b.push(f);else b=a;a=b;if(c.length&&b.length){a=[];e=b[0].position;d=c.length;c=_.u(c);for(f=c.next();!f.done;f=c.next())f=f.value,a.push(new _.Li(e-d--,f.startTime,f.endTime,f.Sa,f.wa,f.ia,f.ya,f.keyInfo,f.Oc,f.timescale,f.horizontalTiles,f.verticalTiles,f.durationPerTile));b=_.u(b);for(f=b.next();!f.done;f=b.next())a.push(f.value)}this.a=
a};_.r.replace=function(a){this.a=a};zA.prototype.release=function(){this.h.stop();for(var a=_.u(this.a),b=a.next();!b.done;b=a.next())b.value.release();this.a.clear()};AA.prototype.release=function(){this.l=null;this.j.clear();this.a=function(){};this.f=function(){};this.h=function(){}};
AA.prototype.o=function(a,b){for(var c={},d=_.u(this.l.cues()),e=d.next();!e.done;c={Le:c.Le,Rd:c.Rd},e=d.next()){e=e.value;c.Le=this.j.get(e)||null;c.Rd=a<e.startTime?1:a>e.endTime?3:2;this.j.set(e,c.Rd);var f=this.w.find(function(g){return function(h){return h.Bc===g.Le&&h.Ac===g.Rd}}(c));f&&f.oc(e,b)}};_.r=EA.prototype;_.r.destroy=function(){this.h=this.w=null;this.o.clear();return Promise.resolve()};
_.r.remove=function(a,b){var c=this;return Promise.resolve().then(function(){!c.h||!c.h.remove(a,b)||null==c.a||b<=c.a||a>=c.f||(a<=c.a&&b>=c.f?c.a=c.f=null:a<=c.a&&b<c.f?c.a=b:a>c.a&&b>=c.f&&(c.f=a))})};_.r.wb=function(){return this.a};_.r.Fa=function(){return this.f};_.r.qc=function(a){return null==this.a||null==this.f?!1:a>=this.a&&a<this.f};_.r.Na=function(a){return null==this.f||this.f<a?0:this.f-Math.max(a,this.a)};
JA.prototype.init=function(a){var b=muxjs.mp4.probe;a=_.Ui(a);this.l=b.videoTrackIds(a);this.j=b.timescale(a);this.a.init()};JA.prototype.h=function(a,b){var c=_.Ui(a);(c=this.a.parse(c,this.l,this.j))&&c.captions&&b(c.captions);this.a.clearParsedCaptions()};JA.prototype.f=function(){this.a.resetCaptionStream()};_.KA.prototype.init=function(){};_.KA.prototype.h=function(){};_.KA.prototype.f=function(){};_.r=_.MA.prototype;
_.r.destroy=function(){var a=this;this.J=!0;var b=[],c;for(c in this.h){var d=this.h[c],e=d[0];this.h[c]=d.slice(0,1);e&&b.push(e.p["catch"](Bz));for(e=1;e<d.length;++e)d[e].p["catch"](Bz),d[e].p.reject()}this.a&&b.push(this.a.destroy());this.B&&b.push(this.B.destroy());for(var f in this.A)b.push(this.A[f].destroy());return Promise.all(b).then(function(){a.l&&(a.l.release(),a.l=null);a.j&&(a.j.removeAttribute("src"),a.j.load(),a.j=null);a.w="";a.o=null;a.a=null;a.B=null;a.f={};a.A={};a.G={};a.H=null;
a.M=!1;for(var g in a.h);a.h={}})};_.r.init=function(a,b,c){c=void 0===c?!1:c;var d=this,e;return _.E(function(f){if(1==f.a)return e=_.fp,_.x(f,d.I,2);a.forEach(function(g,h){var l=_.rk(g.mimeType,g.codecs);if(h==e.TEXT)RA(d,l);else{var m=new Map;m.set(h,l);_.Iz(l)&&b&&!g.keyInfo||!Mz(l,h)||(d.A[h]=new Jz,l="aac"==l.toLowerCase().split(";")[0].split("/")[1]?l.replace(/aac/i,_.Pe):Lz(h,l),m=Nz(h,l),c&&m["delete"](e.AUDIO));PA(d,m)}});_.y(f)})};
_.r.wb=function(a){return a===_.bg?this.a.wb():(a=TA(this,a))?a.wb():null};_.r.Fa=function(a){return a===_.bg?this.a.Fa():(a=TA(this,a))?a.Fa():null};_.r.qc=function(a,b,c){return a===_.bg?this.a.qc(b):(a=TA(this,a))?a.qc(b,!1,c):!1};_.r.Na=function(a,b){if(a===_.bg)return this.a.Na(b);var c=TA(this,a);return c?c.Na(b):0};
_.r.remove=function(a,b,c){var d=this;return a===_.bg?this.a.remove(b,c):WA(this,a,this.Gh.bind(this,a,b,c)).then(function(){if(a===_.sg){var e=d.wb(a),f=d.Fa(a);null!==e&&null!==f&&Wz(d.C,e,f)}else a===_.$c&&(e=d.C,e.player&&e.player.trigger(new _.L(_.ed)))})};_.r.clear=function(a){if(a==_.bg){if(!this.a)return Promise.resolve();this.H.f();return this.a.remove(0,Infinity)}return WA(this,a,this.Gh.bind(this,a,0,this.o.duration))};
_.r.flush=function(a){return a==_.bg?Promise.resolve():WA(this,a,this.Ig.bind(this,a))};_.r.endOfStream=function(a){var b=this;return bB(this,function(){SA(b)||(a?b.o.endOfStream(a):b.o.endOfStream())})};_.r.getDuration=function(){return this.o.duration};_.r.Ze=function(a,b){this.g.debug("Appending data to "+a+Jy);try{this.f[a].appendBuffer(b)}catch(c){throw this.g.warn("Failed to append data for "+a,c),c;}this.g.debug("Done Appending data to "+a+Jy)};
_.r.Gh=function(a,b,c){if(c<=b)this.$c(a);else{this.g.debug("Removing data from "+a+" range:",b,c);try{this.f[a].remove(b,c)}catch(d){throw this.g.warn("Failed to remove data from "+a+" buffer. Range:",b,c,d),d;}this.g.debug("Done Removing data from "+a+" range:",b,c)}};
_.r.di=function(a){try{this.g.debug("Aborting operations for "+a+Jy);var b=this.f[a].appendWindowStart,c=this.f[a].appendWindowEnd;this.f[a].abort();this.f[a].appendWindowStart=b;this.f[a].appendWindowEnd=c}catch(d){throw this.g.warn("Failed to abort operations for "+a+Jy,d),d;}this.g.debug("Done Aborting operations for "+a+Jy);this.$c(a)};
_.r.Ig=function(a){try{this.j.readyState>HTMLMediaElement.HAVE_NOTHING?(this.g.debug("Flushing buffer for "+a),this.j.currentTime-=.001):this.g.warn("Skip buffer flush for "+a+" with element state: "+this.j.readyState)}catch(b){throw this.g.warn("Failed to flush buffer for "+a,b),b;}this.g.debug("Done Flushing buffer for "+a);this.$c(a)};
_.r.Lh=function(a,b){0>b&&(b+=.001);try{this.g.debug("Setting timestamp offset for "+a,b),this.f[a].timestampOffset=b}catch(c){throw this.g.warn("Failed to set timestamp offset for "+a,b,c),c;}this.g.debug("Done Setting timestamp offset for "+a,b);this.$c(a)};
_.r.gm=function(a,b,c){try{this.g.debug("Setting append window for "+a,b,c),this.f[a].appendWindowStart=0,this.f[a].appendWindowEnd=c,this.f[a].appendWindowStart=b}catch(d){throw this.g.warn("Failed to set append window for "+a,b,c,d),d;}this.g.debug("Done Setting append window for "+a,b,c);this.$c(a)};_.r.U=function(a){this.h[a][0].p.reject(new _.P(_.Q,3,3014,{mediaError:this.j.error?this.j.error.code:0}))};
_.r.$c=function(a){var b=this.h[a][0];b&&(b.p.resolve(),this.g.debug("Update-End received for "+a),eB(this,a))};_.r.getTextDisplayer=function(){return this.B};var OA=window.URL.createObjectURL;_.w(BB,_.U);_.r=BB.prototype;_.r.initialize=function(a){this.m=a};_.r.release=function(){this.h=[];this.a.clear();this.f.clear()};_.r.load=function(){};_.r.destroy=function(){this.release();this.m=null};_.r.getVideoTracks=function(){return CB(this,_.Qj)};_.r.getAudioTracks=function(){return CB(this,_.T)};_.r.fa=function(){return CB(this,_.S)};_.r.ka=function(){return this.a.get(_.Qj)||null};_.r.Qa=function(){return this.a.get(_.T)||null};_.r.Ha=function(){return this.a.get(_.S)||null};
_.r.bb=function(){return this.f.get(_.Qj)||null};_.r.mb=function(){return this.f.get(_.T)||null};_.r.nb=function(){return this.f.get(_.S)||null};_.r.Ia=function(){return DB(this,_.Qj)};_.r.ja=function(){return DB(this,_.T)};_.r.ua=function(){return DB(this,_.S)};_.r.ib=function(a){FB(this,_.Qj,a)};_.r.za=function(a){FB(this,_.T,a)};_.r.La=function(a){FB(this,_.S,a)};_.r.Ya=function(a,b){EB(this,_.Qj,a,void 0===b?!1:b)};_.r.gb=function(a,b){EB(this,_.T,a,void 0===b?!1:b)};
_.r.hb=function(a,b){b=void 0===b?!1:b;var c=a;if(!a){var d=this.Ha();if(d&&d.track.kind!==_.oe){var e=this.fa().find(function(g){return g.kind===_.oe&&g.language===d.track.language});if(!e){var f=this.ja();f&&(e=this.fa().find(function(g){return g.kind===_.oe&&g.language===f.language}))}e&&(c=e.renditions[0])}}EB(this,_.S,c,b)};_.r.addTextTrack=function(a){var b=this;return _.E(function(c){return b.m?_.x(c,b.m.addTextTrack(a.url,a.language,a.kind,a.mimeType,a.codec,a.label),0):c.F(0)})};
_.r.ma=function(){return!!this.m&&this.m.ma()};BB.prototype.isAbrEnabled=BB.prototype.ma;BB.prototype.addTextTrack=BB.prototype.addTextTrack;BB.prototype.setTextRendition=BB.prototype.hb;BB.prototype.setAudioRendition=BB.prototype.gb;BB.prototype.setVideoRendition=BB.prototype.Ya;BB.prototype.setTextTrack=BB.prototype.La;BB.prototype.setAudioTrack=BB.prototype.za;BB.prototype.setVideoTrack=BB.prototype.ib;BB.prototype.getTextTrack=BB.prototype.ua;BB.prototype.getAudioTrack=BB.prototype.ja;
BB.prototype.getVideoTrack=BB.prototype.Ia;BB.prototype.getLoadingTextRendition=BB.prototype.nb;BB.prototype.getLoadingAudioRendition=BB.prototype.mb;BB.prototype.getLoadingVideoRendition=BB.prototype.bb;BB.prototype.getTextRendition=BB.prototype.Ha;BB.prototype.getAudioRendition=BB.prototype.Qa;BB.prototype.getVideoRendition=BB.prototype.ka;BB.prototype.getTextTracks=BB.prototype.fa;BB.prototype.getAudioTracks=BB.prototype.getAudioTracks;BB.prototype.getVideoTracks=BB.prototype.getVideoTracks;_.r=_.RB.prototype;_.r.stop=function(){this.w=null;this.h=!1;this.l=[];this.j=1;this.f=null;this.C=!1};_.r.init=function(a){this.w=a};
_.r.chooseVariant=function(){var a=SB(!this.C&&this.a.initialRestrictions?this.a.initialRestrictions:this.a.restrictions,this.l),b=this.getBandwidthEstimate();this.l.length&&!a.length&&(this.g.warn("No variants met the ABR restrictions. Choosing a variant by lowest bandwidth."),a=SB(null,this.l),a=[a[0]]);var c=a[0]||null;a=_.u(_.YE(a));for(var d=a.next();!d.done;d=a.next()){var e=d.value;d=e.item;var f=isNaN(this.j)||0===this.j?1:Math.abs(this.j),g=f*d.bandwidth,h=g/this.a.bandwidthDowngradeTarget;
e=f*(e.next||{bandwidth:Infinity}).bandwidth/this.a.bandwidthUpgradeTarget;this.g.debug("Bandwidth ranges:",(g/1E6).toFixed(3),(h/1E6).toFixed(3),(e/1E6).toFixed(3));b>=h&&b<=e&&(c=d)}this.f=Date.now();this.C=!0;return c};_.r.enable=function(){this.h=!0};_.r.disable=function(){this.h=!1};
_.r.segmentDownloaded=function(a,b){this.g.debug("Segment downloaded:","deltaTimeMs\x3d"+a,"numBytes\x3d"+b,"lastTimeChosenMs\x3d"+this.f,"enabled\x3d"+this.h);var c=this.o;if(!(16E3>b)){var d=8E3*b/a,e=a/1E3;c.a+=b;_.cA(c.f,e,d);_.cA(c.h,e,d)}if(null!=this.f&&this.h)a:{this.g.debug("Suggesting Streams...");if(!this.B){if(!(128E3<=this.o.a)){this.g.debug("Still waiting for a good estimate...");break a}this.B=!0;if(this.a.useSwitchIntervalForInitialSwitch&&Date.now()-this.f<1E3*this.a.switchInterval){this.g.debug("Skipping initial estimation switch due to switch interval...");
break a}}else if(Date.now()-this.f<1E3*this.a.switchInterval){this.g.debug("Still within switch interval...");break a}c=this.chooseVariant();d=this.getBandwidthEstimate();this.g.debug("Calling switch_(), bandwidth\x3d"+Math.round(d/1E3)+" kbps");c&&this.w(c)}};_.r.playbackRateChanged=function(a){this.j=a};_.r.getBandwidthEstimate=function(){var a=this.A&&this.A.Mg();a||(a=this.o,a=128E3>a.a?this.a.defaultBandwidthEstimate:Math.min(_.dA(a.f),_.dA(a.h)));return a};
_.r.setVariants=function(a){this.l=a};_.r.setCmsdManager=function(a){this.A=a};_.r.configure=function(a){this.a=a};_.r.reset=function(){this.B=!1;this.o=new QB;var a=this.chooseVariant();a&&this.w(a)};TB.prototype.clear=function(){this.a.clear()};WB.prototype.add=function(a){if(ZB(this.f,a))return this.a.add(a),!0;_.J("Rejecting variant - not compatible with root.");return!1};WB.prototype.values=function(){return this.a.values()};aC.prototype.create=function(a){var b=this,c=a.filter(function(d){return ZB(b.a,d)});return c.length?new WB(c[0],c):this.f.create(a)};
$B.prototype.create=function(a){var b=bC(a,this.h);0<b.length&&(a=b);b=!1;if(this.a){var c=cC(a,this.a);0<c.length?(a=c,b=!0):_.J("No exact match for preferred variant role could be found. Role: "+this.a)}b||(b=a.filter(function(d){return d.primary}),0<b.length&&(a=b));this.f&&(b=gB(a,this.f),b.length?a=b:_.J("No exact match for the channel count could be found."));b=dC(a,this.j);b.length?a=b:_.J("No exact match for spatial audio could be found.");b=new WB(a[0]);a=_.u(a);for(c=a.next();!c.done;c=
a.next())c=c.value,ZB(b.f,c)&&b.add(c);return b};gC.prototype.getState=function(){return this.a};var fC=0,eC=1;iC.prototype.release=function(){this.f.release()};jC.prototype.release=function(){this.a=this.h=null;this.f=function(){}};jC.prototype.o=function(a){var b=this.a,c=this.h.periods;a=Xz(c,a)||c[0];b!=a&&this.f(a);this.a=a};lC.prototype.getConfiguration=function(){return this.j};lC.prototype.release=function(){this.a&&(this.a.stop(),this.a=null);this.f=null};lC.prototype.set=function(a,b){this.h=a;pC(this,b)};rC.prototype.release=function(){this.h=null;this.f=function(){}};vC.prototype.release=function(){this.h&&(this.h.release(),this.h=null);null!=this.w&&(this.w.stop(),this.w=null);this.f&&(this.f.release(),this.f=null);this.a=this.G=this.C=null;this.o=!1};vC.prototype.xe=function(){this.A=!0;uC(this)};zC.prototype.release=function(){this.f&&(this.f.release(),this.f=null);null!=this.h&&(this.h.release(),this.h=null);this.j=function(){};this.a=null;this.o=function(){};this.w=!1};wC.prototype.release=function(){this.a&&(this.a.stop(),this.a=null);this.f=null};HC.prototype.release=function(){this.f&&(this.f.release(),this.f=null);this.j&&(this.j.release(),this.j=null);this.o&&(this.o.stop(),this.o=null);this.h=this.f=this.a=this.l=null;this.A=function(){}};var NC=new _.Eo(function(){return new Uint8Array([0,0,0,80,115,105,110,102,0,0,0,12,102,114,109,97,0,0,0,0,0,0,0,20,115,99,104,109,0,0,0,0,99,101,110,99,0,1,0,0,0,0,0,40,115,99,104,105,0,0,0,32,116,101,110,99,0,0,0,0,0,0,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])});var vD;_.r=_.PC.prototype;_.r.destroy=function(){var a=this,b,c,d,e;return _.E(function(f){if(1==f.a){b=[];c=_.u(a.a.values());for(d=c.next();!d.done;d=c.next())e=d.value,$C(e),b.push(aD(e));return _.x(f,Promise.all(b),2)}a.a.clear();a.o.clear();a.D=null;a.j=null;a.G=null;a.l=null;a.h=null;a.f=!0;_.y(f)})};
_.r.start=function(){var a=this,b,c,d;return _.E(function(e){if(1==e.a){b=a.D.Cb();c=WC(a,b);d=a.D.wf(QC(a)[c]);if(!d.variant&&!d.text)throw a.g.error("start(): No streams chosen"),new _.P(_.Q,5,5005);a.C=!d.variant&&!!d.text;return _.x(e,qD(a,d.variant?d.variant.audio:null,d.variant?d.variant.video:null,d.text,b),2)}if(a.f)return e["return"]();a.g.debug("init: completed initial Stream setup");a.D&&a.D.nl&&(a.g.debug("init: calling onInitialStreamsSetup()..."),a.D.nl());_.y(e)})};
_.r.Hb=function(a){var b=this,c,d,e,f;return _.E(function(g){switch(g.a){case 1:if(b.f)return g["return"]();c=gD(a);if(a.eb||null==a.vb||a.hc)return g["return"]();a.vb=null;if(!a.Mb){g.F(2);break}b.g.debug(c,"skipping update and clearing the buffer");return _.x(g,jD(b,a,a.Ee,a.ae),3);case 3:return g["return"]();case 2:_.A(g,4);d=uD(b,a);null!=d&&(YC(b,a,d),a.Uc=!1);_.ah(g,5);break;case 4:return e=_.C(g),_.x(g,FD(b,e),6);case 6:return g["return"]();case 5:f=Array.from(b.a.values()),KD(b,a),b.B&&f.every(function(h){return h.endOfStream})&&
(b.g.debug(c,"calling endOfStream()..."),b.D.X.endOfStream().then(function(){if(!b.f){var h=b.D.X.getDuration();h<b.j.presentationTimeline.getDuration()&&(b.j.presentationTimeline.f=h)}}).then(function(){b.D.nh()})),_.y(g)}})};
_.r.Jl=function(a,b,c,d){var e=rz(d.reader),f=rz(d.reader),g=_.W(d.reader),h=_.W(d.reader),l=_.W(d.reader),m=_.W(d.reader);d=_.lm(d.reader,d.reader.Ga()-d.reader.getPosition());a=a.startTime+b.startTime+h/g;if(c.includes(e))if("urn:mpeg:dash:event:2012"==e)this.D.rh();else this.D.onEvent(new _.L("emsg",{detail:{startTime:a,endTime:a+l/g,schemeIdUri:e,value:f,timescale:g,presentationTimeDelta:h,eventDuration:l,id:m,messageData:d}}))};
_.r.Am=function(a){var b=this,c=!1,d=0;(new _.mm).L(_.Oe,_.nm).L(_.fg,_.nm).L(_.Je,_.nm).L(_.Ne,_.nm).L(_.Vf,_.nm).Y(_.Xf,_.om).L("encv",function(e){e.reader.skip(78);_.nm(e)}).L("pasp",function(e){d=e.start+e.headerSize;var f=_.W(e.reader),g=_.W(e.reader);c=f!==g;b.g.debug("hSpacing\x3d"+f+", vSpacing\x3d"+g+", updatePASP\x3d"+c);e.parser.stop()}).parse(a.data);c&&(a=new _.am(new DataView(a.data)),a.seek(d),_.V(a,1),_.V(a,1))};vD="iterateSegmentReference";_.ZE={ITERATOR:vD,LOOKUP:_.ez};_.w(ND,_.Dl);_.r=ND.prototype;_.r.init=function(a,b){var c=a.getMedia();_.Dl.prototype.init.call(this,a,b);TD(this,c)};_.r.namespace=function(){return cz};_.r.yg=function(){return new BB};_.r.getState=function(){return this.qa};_.r.getDrmInfo=function(){return this.l?this.l.getDrmInfo():null};
_.r.unload=function(){var a=this;HB(this,!1);this.sd=!1;if(this.w){var b=this.getTrackManager();b&&b.release();return this.G===QD?Promise.resolve():VD(this).then(function(){a.log.debug(_.Qb,a.w);a.w=null;a.Hf=0;a.Jc=null;a.da=null})}return Promise.resolve()};
_.r.release=function(){var a=this;return _.E(function(b){if(a.ha)return b["return"](a.ha);a.ha=new Promise(function(c,d){try{var e=a.Yb;a.Yb=null;var f=e;e&&(f=e["catch"](function(){}));f?f=f.then(function(){return _.Dl.prototype.release.call(a)}):f=_.Dl.prototype.release.call(a);f=f.then(function(){return a.unload()});f.then(function(){PD(a,_.Ho);a.ha=null;c()})["catch"](function(g){a.ha=null;d(g)})}catch(g){a.ha=null,d(g)}});return b["return"](a.ha)})};
_.r.getBufferInfo=function(a){if(this.M){var b=UA(this.M),c=new _.sl(void 0,a);switch(a){case _.Qj:return b.video?b.video:c;case _.T:return b.audio?b.audio:c;case _.S:return b.text?b.text:c}return b.total?b.total:c}return this.wd?(b=Tz(this.wd),Qz(b,a)):_.Dl.prototype.getBufferInfo.call(this,a)};_.r.getPosition=function(){return this.A?JC(this.A):_.Dl.prototype.getPosition.call(this)};_.r.getPresentationStartTime=function(){return this.f?this.f.presentationTimeline.getPresentationStartTime():null};
_.r.getDuration=function(){return this.f?this.f.presentationTimeline.getDuration():Infinity};_.r.destroy=function(){var a=this;return _.E(function(b){if(1==b.a)return _.x(b,_.Dl.prototype.destroy.call(a),2);if(3!=b.a){if(a.G===QD)return b["return"]();a.log.debug("Destroying player...");a.G=QD;return _.x(b,SD(a),3)}a.o&&(a.o.release(),a.o=null);a.h=null;a.I&&(a.I.release(),a.I=null);_.y(b)})};
_.r.lg=function(){var a=this;return _.E(function(b){if(1==b.a){if(!a.re)return a.log.warn("No preloaded asset found"),b["return"]();a.log.info("Loading preloaded asset",a.re);a.re=null;return _.x(b,$D(a),2)}return _.x(b,aE(a),0)})};_.r.preload=function(a){var b=this;return _.E(function(c){if(1==c.a)return _.rn("preload.start"),b.log.info("Preloading asset",a),_.x(c,bE(b,a,!1),2);b.re=a;b.log.info("Preloaded asset",a);_.rn("preload.end");_.sn("preload","preload.start","preload.end");_.y(c)})};
_.r.load=function(a){return bE(this,a)};_.r.detach=function(){var a=this;return _.E(function(b){return 1==b.a?_.x(b,RD(a),2):b["return"](SD(a))})};_.r.isLive=function(){var a;this.f?(a=this.f.presentationTimeline.isLive())||(a=this.f.presentationTimeline,a=Infinity!=a.f&&!a.j):a=!1;return a};_.r.wh=function(){this.log.debug("User seeking finished");this.H&&mE(this);nE(this)};_.r.getSeekRange=function(){if(this.f){var a=this.f.presentationTimeline;return{start:_.oA(a,0),end:nA(a)}}return{start:0,end:0}};
_.r.Tc=function(){return this.f?this.f.presentationTimeline.Tc():null};_.r.getPlaybackRate=function(){if(this.K){var a=this.K;a=a.l?0:a.h}else a=0;return a};
_.r.setPlaybackRate=function(a,b){if(0===a)this.log.warn("A trick play rate of 0 is unsupported!");else if(this.G===MD){if(_.Dj()){this.log.warn("Pausing and unpausing to mitigate playbackRate platform issue.");var c=this.getSurface().getMedia();c.pause();this.K.set(a,b);c.play()}else this.K.set(a,b);if((c=this.K.getConfiguration())&&c.preferTrickPlayTracks){c=this.a;var d=1<Math.abs(a),e=c.a.get(_.sg);if(e){var f=e.stream;if(f)if(c.g.debug("setTrickPlay",d),d)(d=f.trickModeVideo)&&!e.ac&&(c.g.debug("Engaging trick mode stream",
d),_.cD(c,d,!1,0),e.ac=f);else if(f=e.ac)c.g.debug("Restoring non-trick-mode stream",f),e.ac=null,_.cD(c,f,!0,0)}}this.h.playbackRateChanged(a)}};_.r.fa=function(){if(this.f&&this.A){var a=gE(this);if(null==a)a=null;else{if(!VB(this.V,a).text){var b=_.uB(a.textStreams,this.md,this.ne,this.ld);b.length&&(b=b[0],VB(this.V,a).text=b)}a=VB(this.V,a).text}b=[];for(var c=_.u(ME(this)),d=c.next();!d.done;d=c.next()){d=d.value;var e=rB(d);e.active=d==a;b.push(e)}return b}return[]};_.r.getPeriods=function(){return this.f.periods};
_.r.getStats=function(){if(this.G!==MD)return _.Do();nE(this);var a=this.j;if(a.getVideoPlaybackQuality){a=a.getVideoPlaybackQuality();var b=this.J,c=Number(a.totalVideoFrames);b.l=Number(a.droppedVideoFrames);b.j=c}if(this.G===MD){if(a=yE(this))this.J.o=a.bandwidth;a&&a.video&&(b=this.J,c=a.video.height||NaN,b.w=a.video.width||NaN,b.h=c);a=this.h.getBandwidthEstimate();this.J.f=a}return this.J.getStats()};_.r.he=function(){return this.gc};
_.r.getTimelineCues=function(){return this.gc?Array.from(this.gc.a.values()).map(pA):[]};_.r.resetAbr=function(){this.h&&this.h.reset()};
_.r.addTextTrack=function(a,b,c,d,e,f){var g=this,h,l,m,n,p,q,t,v,z;return _.E(function(D){if(1==D.a){if(g.G!==MD)throw g.log.error("Must call load() and wait for it to resolve before adding text tracks."),Error("State error!");h=gE(g);l=_.fp;m=g.f.periods.indexOf(h);n=m+1;p=n>=g.f.periods.length?g.f.presentationTimeline.getDuration():g.f.periods[n].startTime;q=p-h.startTime;if(Infinity==q)throw new _.P(1,4,4040);t=new _.Li(1,0,q,function(){return[a]},0,null,0);v={id:g.Uh++,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),
findSegmentPosition:function(){return 1},getSegmentReference:function(G){return 1==G?t:null},adjustSegmentDurations:function(){},getDuration:function(){return q},segmentLookupStrategy:_.ez,initSegmentReference:null,mimeType:d,codecs:e||"",kind:c,encrypted:!1,keyId:null,language:b,originalLanguage:b,label:f||null,type:l.TEXT,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,spatialAudio:!1,closedCaptions:null};g.qe.add(v);h.textStreams.push(v);return _.x(D,ZC(g.a,v),
2)}if(z=_.SC(g.a,_.bg))VB(g.V,h).text=z;g.qe["delete"](v);g.log.debug("Choosing new streams after adding a text stream");xE(g,h);iE(g);return D["return"](rB(v))})};
_.r.dj=function(a){this.log.debug(_.iz,a);try{this.log.debug("onChooseStreams_, choosing variant from ",a.variants);this.log.debug("onChooseStreams_, choosing text from ",a.textStreams);var b=KE(this,a);this.log.debug("onChooseStreams_, chose variant ",b.variant);this.log.debug("onChooseStreams_, chose text ",b.text);return b}catch(c){return this.onError(c),{variant:null,text:null}}};
_.r.cj=function(){this.log.debug("canSwitch_");this.ea=!1;this.configuration.abr.enabled&&this.h.enable();this.Da&&(dD(this.a,this.Da,this.Oh,this.Kh),this.Da=null);this.pa&&(_.cD(this.a,this.pa,!0,0),this.pa=null)};_.r.ej=function(){this.B&&this.B.update&&this.B.update()};_.r.yl=function(){this.A&&this.A.j.xe()};
_.r.li=function(a,b,c){if((void 0===c?"":c)===fz)return iE(this),this.ma()||(this.configuration.abr.enabled=!0,this.h.enable()),xE(this,b,!1),!0;if(c=b.variants.some(function(g){var h=!1,l=g[a.type];l&&(h=g.allowedByApplication&&l.id!==a.id,a.type===_.$c&&(h=h&&l.language===a.language));return h})&&this.ma()){for(var d=_.u(b.variants),e=d.next();!e.done;e=d.next()){e=e.value;var f=e[a.type];f&&f.id===a.id&&(e.allowedByApplication=!1)}iE(this);this.ma()||(this.configuration.abr.enabled=!0,this.h.enable());
xE(this,b)}return c};_.r.ll=function(){this.log.debug("endOfStream called by streaming engine");this.sd=!0};_.r.onError=function(a){if(this.G!==QD&&7001!==a.code&&7E3!==a.code){var b=new _.L(_.ne,{detail:a});a.severity===_.Q&&PD(this,_.So);this.trigger(b);b.defaultPrevented&&(b.a=!0)}};_.r.Ye=function(a){a.type===_.he?this.dispatchEvent(a):"largegap"!==a.type&&(a.type===_.Bg?cE(this):"emsg"!==a.type&&(a instanceof _.L?this.dispatchEvent(a):this.log.debug(_.fc,a.type)))};_.r.ma=function(){return this.configuration.abr.enabled};
_.r.tm=function(a){var b=this,c,d,e,f,g,h,l,m;return _.E(function(n){switch(n.a){case 1:if(!b.Hc)return n["return"]();b.log.info("Attempt to switch CDN.");c=b.getLoadedSource();d=b.ma();return _.x(n,b.Hc(c.url,a),2);case 2:e=n.f;if(!e)return n["return"]();f=_.N.oa(b.getLoadedSource(),{url:e});d&&b.h.disable();return _.x(n,kD(b.a),3);case 3:g=yE(b);case 4:return h=!1,_.A(n,7),b.log.info("Switching CDN to "+f.url+"."),_.x(n,NE(b,f,g),9);case 9:_.ah(n,6);break;case 7:return l=_.C(n),b.log.info("Switch failed"),
_.x(n,b.Hc(f.url,a),10);case 10:if(m=n.f)f.url=m,h=!0;else throw l;case 6:h?n.F(4):(d&&b.h.enable(),iD(b.a,!0),b.w[b.getSourceIndex()]=f,a.f=!0,b.trigger(new _.L(_.pd,{newManifest:f.url})),_.y(n))}})};ND.prototype.detach=ND.prototype.detach;var QD=0,LD=1,MD=2,hE=[_.bf,_.ve];OE.prototype.a=function(){return cz};
OE.prototype.canPlay=function(a,b){if(_.Ak())return 0;var c=a.type||"",d=(window.ManagedMediaSource?!0:!1)||(window.MediaSource&&MediaSource.isTypeSupported?!0:!1),e=window.ManagedMediaSource||window.MediaSource&&MediaSource.isTypeSupported?c in _.Ds||_.Es(a.url)in _.Fs?!0:!1:!1;if(d&&e){if(_.Dj(2))return 1;if(_.Bk()&&c===_.dl){if(b.streaming.preferNativeHlsOnSafari)return 1;_.J("Support for MSE + FairPlay on Apple is experimental. In case of issues, consider using native HLS.")}return 2}return 0};
OE.prototype.create=function(){return new ND};_.zh(new OE);_.Kp(function(){_.th("MediaSource.install");if(window.MediaSource)if(window.cast&&cast.__platform__&&cast.__platform__.canDisplayType)_.sh("Patching Chromecast MSE bugs."),TE();else if(_.Bk()){var a=navigator.appVersion;a=0<=a.indexOf("Version")?parseInt(a.match(/Version\/(\d+)/)[1],10):13;RE();10>=a?(_.sh("Blacklisting MSE on Safari \x3c\x3d 10."),window.MediaSource=null):12>=a?(_.sh("Patching Safari 11 \x26 12 MSE bugs."),PE(),QE()):(_.sh("Patching Safari 13 MSE bugs."),PE())}else _.Dj(2)||_.Dj(3)||
_.Dj(4)?SE():_.sh("Using native MSE as-is.");else _.sh("No MSE implementation available.")});_.w(UE,_.pt);_.r=UE.prototype;
_.r.append=function(a){function b(e){if(e.startTime>=e.endTime)_.J("Invalid cue times: "+e.startTime+" - "+e.endTime),e=null;else{var f=e.payload||"";f=f.replace(/<br\s*\/?>/igm,"\n");f=_.R.Pf(f);f=new VTTCue(e.startTime,e.endTime,f);f.line=-1;try{f.align=_.sd}catch(g){f.align="middle"}e.writingMode===_.qg?f.vertical="lr":e.writingMode===_.rg&&(f.vertical="rl");e=f}e&&c.push(e)}var c=[],d=_.u(a);for(a=d.next();!a.done;a=d.next())b(a.value);a=c.slice().sort(function(e,f){return e.startTime!==f.startTime?
e.startTime-f.startTime:e.endTime!==f.endTime?e.endTime-f.startTime:c.indexOf(f)-c.indexOf(e)});d=_.u(a);for(a=d.next();!a.done;a=d.next())this.a.addCue(a.value)};_.r.remove=function(a,b){if(!this.a)return!1;VE(this.a,function(c){return c.startTime<b&&c.endTime>a});return!0};_.r.isTextVisible=function(){return this.a.mode==_.Nf};_.r.setTextVisibility=function(a){null!==this.a&&(this.a.mode=a?_.Nf:_.se)};_.r.destroy=function(){this.a&&VE(this.a,function(){return!0});this.a=null;return Promise.resolve()};WE.prototype.ba=function(){return!0};WE.prototype.create=function(a){return new UE(a)};_.uo("single-native",new WE);};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();