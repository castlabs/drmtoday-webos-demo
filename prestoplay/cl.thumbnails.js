(function(){var g={}; var _ = _ || {}
var f=function(window){var dx="No thumbnail found for position: ",ex="Position is out of range: ",fx="Thumbnail URL is mandatory",gx="Wrong gridSize format",hx="clpp.thumbnails",ix=function(){this.log=new _.K(hx);this.player=null;this.a=[];this.w=!1},kx=function(a,b){b.reduce(function(c,d){var e=d,f=!1;typeof d===_.Te&&(e=d.step,f=d.preloadWhileBuffering);return c.then(function(){return jx(a,0,e,!!f)})},Promise.resolve())},jx=function(a,b,c,d){if(a.w||b>=a.a.length)return Promise.resolve();var e=b+c;return lx(a,d).then(function(){return a.a[b].load()}).then(function(){return jx(a,
e,c,d)})},lx=function(a,b){return new Promise(function(c){if(b||a.player.getState()!==_.Mo)c();else a.player.one(_.id,function(){c()})})},mx=function(a,b,c,d,e,f,g,h,l,m,n,p){d=void 0===d?0:d;e=void 0===e?0:e;f=void 0===f?0:f;g=void 0===g?0:g;h=void 0===h?1:h;l=void 0===l?1:l;m=void 0===m?0:m;n=void 0===n?0:n;p=void 0===p?new Image:p;this.time=b;this.src=a;this.duration=c;this.x=d;this.y=e;this.width=f;this.height=g;this.la=p;this.Bj=h;this.fm=l;this.qk=m;this.rk=n;this.Yb=null},nx=function(){ix.call(this);
this.f=null;this.o=this.h=1;this.j=0},ox=function(a,b){this.time=a;this.duration=0;this.offset=b;this.length=0;this.Kd=new _.wj},px=function(){this.g=new _.K(hx);this.f=new ArrayBuffer(0);this.a=[];this.h=new _.wj},qx=function(a){var b=a.f.byteLength;a.a.forEach(function(c){c.offset+c.length<b&&c.Kd.resolve()})},sx=function(a,b){return rx(a,b).then(function(c){return new mx(c,b.time,b.duration)})},rx=function(a,b){return b.load().then(function(){var c=_.Ui(a.f,b.offset,b.length);return"data:image/jpeg;base64,"+
_.dj(c)})},tx=function(){ix.call(this);this.f=null},ux=function(a){a=a.split(/\.|:/).map(parseFloat);var b=0,c,d={3:.001,2:1,1:60,0:3600};for(c=a.length-1;0<=c;c--)b+=a[c]*d[c];return b},vx=function(){ix.apply(this,arguments)},wx=function(a,b){var c=a.horizontalTiles||b.horizontalTiles||1,d=a.verticalTiles||b.verticalTiles||1,e=c*d;return{Dd:c,Wf:d,Wg:e,durationPerTile:a.durationPerTile||b.durationPerTile||(a.endTime-a.startTime)/e}},xx=function(){this.g=new _.K(hx);this.a=this.m=null},yx=function(a){return a.some(function(b){return 0<
b.thumbStreams.length})},Dx=function(a){return a?a===zx||a===Ax?new nx:a===Bx?new tx:a===Cx?new px:null:null},Ex=function(a){if(!a)return null;a=new _.Xj(a);return a.path.match(/.*\.vtt$/i)?Bx:a.path.match(/.*\.bif$/i)?Cx:a.path.match(/.*\.(png|jpg|jpeg)$/i)?zx:null},Fx=function(){};ix.prototype.init=function(a,b){var c=this;this.player=a;a.one(_.Gf,function(){c.w=!0});a.isLive()||this.l().then(function(){b&&b.preload&&kx(c,b.preload)})};mx.prototype.raw=function(){return this.la.cloneNode(!1)};
mx.prototype.element=function(a,b){var c=this.width,d=this.height,e=this.width/this.height;void 0!==a&&void 0===b&&(b=0);null!==a&&void 0!==a&&(c=a);null!==b&&void 0!==b&&(d=b);c||(c=Math.ceil(d*e));d||(d=Math.ceil(c/e));e=document.createElement(_.Yd);e.style.width=c+_.Df;e.style.height=d+_.Df;e.style.backgroundColor="#000";e.style.backgroundRepeat="no-repeat";e.style.backgroundImage='url("'+this.src+'")';e.style.backgroundSize=Math.ceil(c/this.width*(this.la.naturalWidth||this.la.width))+"px "+Math.ceil(d/
this.height*(this.la.naturalHeight||this.la.height))+_.Df;var f=this.y/this.height;e.style.backgroundPositionX="-"+this.x/this.width*c+_.Df;e.style.backgroundPositionY="-"+f*d+_.Df;return e};
mx.prototype.load=function(){var a=this;this.Yb||(this.Yb=new Promise(function(b,c){function d(){a.width||(a.width=(a.la.naturalWidth||a.la.width)/a.Bj);a.height||(a.height=(a.la.naturalHeight||a.la.height)/a.fm);a.x||(a.x=a.width*a.qk);a.y||(a.y=a.height*a.rk)}if(a.la.src&&a.la.complete)d(),b(a);else{var e=null,f=function(){d();a.la.removeEventListener("load",f);a.la.removeEventListener(_.ne,e);b(a)};e=function(g){a.la.removeEventListener("load",f);a.la.removeEventListener(_.ne,e);c(new _.P(1,9,
2014,"Failed to load thumbnail.",g))};a.la.addEventListener("load",f);a.la.addEventListener(_.ne,e);a.la.src=a.src}}));return this.Yb};_.H("clpp.thumbnails.Thumbnail",mx);mx.prototype.load=mx.prototype.load;mx.prototype.element=mx.prototype.element;mx.prototype.raw=mx.prototype.raw;_.w(nx,ix);
nx.prototype.init=function(a,b){if(!b||!b.url)throw new _.P(1,9,7100,fx);if("GRID"===b.mode&&!b.gridSize)throw new _.P(1,9,7100,"Grid size is mandatory for GRID mode");if(!b.duration)throw new _.P(1,9,7100,"Duration is mandatory");this.f=b;this.j=this.f.duration;if(this.f.gridSize)try{var c=this.f.gridSize.split(/x/).map(function(d){return parseInt(d,10)}).filter(function(d){return 0<d});if(2===c.length)this.h=c[0],this.o=c[1];else throw new _.P(1,9,7100,gx);}catch(d){throw this.log.error("Error during parsing gridSize",d),
new _.P(1,9,7100,gx);}ix.prototype.init.call(this,a,b)};nx.prototype.get=function(a){var b=this,c,d,e,f;return _.E(function(g){if(1==g.a){c=b.player.getDuration();if(0>a||a>c)throw new _.P(1,9,2014,ex+a);d=b.f.duration;e=Math.floor(a/d);f=b.a[e];if(!f)throw new _.P(1,9,2014,"No thumbnail found for position "+a+" at index "+e);return _.x(g,f.load(),2)}return g["return"](f)})};
nx.prototype.l=function(){if(0<this.a.length)return Promise.resolve();var a=this.player.getDuration(),b=this.h*this.o;a=Math.ceil(Math.ceil(a/this.j)/b);for(var c=this.f.templateKey||"$index$",d=0;d<a;d++)for(var e=this.f.url.replace(c,String(d+1)),f=new Image,g=0;g<b;g++)this.a.push(new mx(e,this.j*(d*b+g),this.j,0,0,0,0,this.h,this.o,g%this.h,Math.floor(g/this.h),f));return Promise.resolve()};ox.prototype.load=function(){return this.Kd};
px.prototype.init=function(a,b){var c=this;if(!b||!b.url)throw new _.P(1,9,7100,fx);var d=b.url,e=_.rj(d);e.type=_.qj;a.getNetworkEngine().fetch(e).O.then(function(f){f=f.data;var g=_.Ui(c.f);f=_.Ui(f);for(var h=g.byteLength+f.byteLength,l=new ArrayBuffer(h),m=new DataView(l),n=0,p=0,q=g.byteLength;p<q;p++)m.setUint8(n,g[p]),n+=1;g=0;for(p=f.byteLength;g<p;g++)m.setUint8(n,f[g]),n+=1;c.f=l;c.g.info("Appended "+f.byteLength+" bytes.Total data now "+(h+" bytes."));l=c.f;f=_.Ui(l);n=String.fromCharCode.apply(null,
Gx);g=Array.prototype.slice.call(f,0,8);f=64;h=0;m=!1;if(n===String.fromCharCode.apply(null,g))for(l=new DataView(l,16,20),l=l.getUint32(0,!0),0===l&&(l=1E3);!m;){h+=1;g=l;n=new DataView(c.f,f);m=n.getUint32(0,!0);g=m*g/1E3;n=n.getUint32(4,!0);n=new ox(g,n);if(g=c.a.length)g=c.a[g-1],g.length=n.offset-g.offset,g.duration=n.time-g.time;c.a.push(n);f+=8;(m=4294967295===m)&&c.h.resolve();if(1E5<h)throw Error("There was a problem during reading BIF entries");}else throw Error("The file is not a valid BIF format");
qx(c)})["catch"](function(f){c.g.error("[BIF] Error while loading thumbnails '\n            + 'URL: "+d,f);a.onError(new _.P(1,9,2013,"Error while loading and parsing BIF thumbnails.",f))})};px.prototype.get=function(a){var b=this,c,d;return _.E(function(e){switch(e.a){case 1:if(0>a)throw new _.P(1,9,2014,ex+a);return _.x(e,b.h,2);case 2:c=b.a.find(function(f){return a>=f.time&&a<f.time+f.duration});if(!c)throw new _.P(1,9,2014,dx+a);return _.x(e,sx(b,c),3);case 3:return d=e.f,_.x(e,d.load(),4);case 4:return e["return"](d)}})};
px.prototype.Cd=function(){return 0<this.a.length};var Gx=[137,66,73,70,13,10,26,10];_.w(tx,ix);
tx.prototype.init=function(a,b){var c=this;if(!b||!b.url)throw new _.P(1,9,7100,fx);var d=b.url,e=_.rj(d);e.type=_.qj;this.f=a.getNetworkEngine().fetch(e).O.then(function(f){f=f.data;if(!f)throw Error("No data in the response");f=_.R.Z(f).split(/\n/);for(var g=0;g<f.length;g++){var h=f[g],l=h.split(" --\x3e ");if(2===l.length){h=f[++g];var m=h.indexOf("\x3d"),n=0>m?[]:h.substr(m+1).split(/,/).map(parseFloat);m=n[0];var p=n[1],q=n[2];n=n[3];var t=h.indexOf("#");h=0>t?h:h.substr(0,t);h.match(/^http|^\/\//)||(h=
d.substr(0,d.lastIndexOf("/"))+"/"+h);t=ux(l[0]);l=ux(l[1])-t;c.a.push(new mx(h,t,l,m,p,q,n,0,0))}}})["catch"](function(f){c.log.error("[VTT] Error while loading thumbnails URL: "+d,f);a.onError(new _.P(1,9,2013,"Error while loading VTT thumbnails.",f))});ix.prototype.init.call(this,a,b)};
tx.prototype.get=function(a){var b=this,c;return _.E(function(d){if(1==d.a){if(0>a)throw new _.P(1,9,2014,ex+a);return _.x(d,b.f,2)}if(3!=d.a){c=b.a.find(function(e){return a>=e.time&&a<e.time+e.duration});if(!c)throw new _.P(1,9,2014,dx+a);return _.x(d,c.load(),3)}return d["return"](c)})};tx.prototype.l=function(){return this.f};_.w(vx,ix);
vx.prototype.get=function(a){function b(){return new _.P(1,9,2014,dx+a)}var c=this,d,e,f,g,h,l,m,n,p,q,t,v,z;return _.E(function(D){if(1==D.a){if(0>a)throw c.log.error("Position must be greater than 0 but is "+a),new _.P(1,9,2014,ex+a);d=c.player.getPeriods();for(var G=null,F=_.u(d),B=F.next();!B.done;B=F.next())B=B.value,B.startTime<=a&&(G=B);e=G;if(!e)throw c.log.error("Could not find period for specified position",a),b();f=e.thumbStreams.sort(c.f)[0];if(!f)throw c.log.error("Could not find thumb stream for specified position",a),
b();g=f.findSegmentPosition(a-e.startTime);if(null===g||void 0===g)throw c.log.error("Could not find segment index for specified position",a),b();h=f.getSegmentReference(g);if(!h)return D.F(2);l=wx(h,f);m=Math.floor((a-h.startTime)/l.durationPerTile);0<c.a.length?(p=f.findSegmentPosition(0),null!==p&&(n=c.a[(g-p)*l.Wg+m])):(q=h.Sa())&&0<q.length&&(v=t=0,z=h.startTime,1<l.Wg&&(t=m%l.Dd,v=Math.floor(m/l.Dd),z+=m*l.durationPerTile),n=new mx(q[0],z,l.durationPerTile,void 0,void 0,void 0,void 0,l.Dd,l.Wf,
t,v));return n?_.x(D,n.load(),4):D.F(2)}if(2!=D.a)return D["return"](n);c.log.error("segment reference for specified segment index does not exist",g);throw b();})};vx.prototype.f=function(a,b){return void 0!==a.bandwidth&&void 0!==b.bandwidth?a.bandwidth-b.bandwidth:0};
vx.prototype.l=function(){if(0<this.a.length)return Promise.resolve();var a=this.player.getPeriods();a=_.u(a);for(var b=a.next();!b.done;b=a.next())if(b=b.value.thumbStreams.sort(this.f)[0])for(var c=b.findSegmentPosition(0),d=void 0;null!==c&&!_.N.R(d=b.getSegmentReference(c++));)for(var e=wx(d,b),f=d.Sa()[0],g=new Image,h=d.startTime,l=0;l<e.Wf;++l)for(var m=0;m<e.Dd;++m)this.a.push(new mx(f,h,e.durationPerTile,void 0,void 0,void 0,void 0,e.Dd,e.Wf,m,l,g)),h+=e.durationPerTile;return Promise.resolve()};_.r=xx.prototype;_.r.onPlayerCreated=function(a){this.m=a};_.r.onPlayerWillDestroy=function(){this.m=null};_.r.onPlayerWillRelease=function(){this.a=null};
_.r.onContentWillLoad=function(a){var b=this,c=a.getConfiguration().thumbnails;if(c)if(!1===c.enabled)this.g.info("Thumbnails disabled.");else{var d=c.mode||null;d||(d=Ex(c.url||null));(this.a=Dx(d))?(this.g.info("Loading thumbs configuration",c),this.m.one(_.Fe,function(){b.g.info("Initialize thumbnails provider");try{b.a.init(a,c)}catch(e){b.m.onError(e)}})):this.g.warn("Unknown thumbnail mode",d)}else this.a=null};
_.r.onContentLoaded=function(a,b){for(var c=1;c<arguments.length;++c);if(!this.a&&(c=(c=a.getConfiguration())&&c.thumbnails,!c||void 0===c.enabled||c.enabled)){var d=a.getPeriods();if(yx(d)){this.a=new vx;try{this.a.init(a,c)}catch(e){this.m.onError(e)}}}};_.r.get=function(a){return this.a?this.a.get(a):Promise.reject(new _.P(1,9,2014,"Thumbnail format is not supported"))};_.r.id=function(){return"thumbnails"};_.H("clpp.thumbnails.ThumbnailsPlugin",xx);xx.prototype.get=xx.prototype.get;xx.Id="thumbnails";
Fx.prototype.create=function(){return new xx};_.nq(new Fx);var zx="SINGLE",Ax="GRID",Bx="WEBVTT",Cx="BIF";};
if(typeof(module)!="undefined"&&module.exports){var x=require("./cl.core.js");_ = x._;(f.call(g,this));module.exports=g;}
else if (typeof(define)!="undefined"&&define.amd) {define(["./cl.core"], function(c){_=c._;(f.call(g,this));return g;});}
else{_=this.clpp._;(f.call(g,this));}
})();